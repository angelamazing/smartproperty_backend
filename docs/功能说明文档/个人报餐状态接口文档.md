# ä¸ªäººæŠ¥é¤çŠ¶æ€æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¥å£æ¦‚è¿°

**æ¥å£åç§°**: è·å–ä¸ªäººæŠ¥é¤çŠ¶æ€  
**æ¥å£è·¯å¾„**: `GET /api/dining/personal-status`  
**åŠŸèƒ½æè¿°**: è·å–ç”¨æˆ·æŒ‡å®šæ—¥æœŸçš„ä¸ªäººæŠ¥é¤çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…å«æ—©ä¸­æ™šä¸‰ä¸ªé¤æ¬¡çš„æŠ¥é¤æƒ…å†µï¼Œç”¨äºå‰ç«¯ç”Ÿæˆç”¨é¤å¡ç‰‡ã€‚

## ğŸ” æƒé™è¦æ±‚

- éœ€è¦ç”¨æˆ·è®¤è¯Token
- ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æŠ¥é¤çŠ¶æ€

## ğŸ“¥ è¯·æ±‚å‚æ•°

### Query Parameters

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| date | string | å¦ | ä»Šå¤© | æŸ¥è¯¢æ—¥æœŸï¼Œæ ¼å¼ï¼šYYYY-MM-DD |

### è¯·æ±‚ç¤ºä¾‹

```http
GET /api/dining/personal-status?date=2025-09-04
Authorization: Bearer {your-jwt-token}
Content-Type: application/json
```

## ğŸ“¤ å“åº”æ•°æ®

### æˆåŠŸå“åº” (200)

```json
{
  "success": true,
  "message": "è·å–ä¸ªäººæŠ¥é¤çŠ¶æ€æˆåŠŸ",
  "code": "200",
  "timestamp": "2025-09-04T10:15:08.638Z",
  "data": {
    "userId": "user_123",
    "userName": "å¼ ä¸‰",
    "department": "æŠ€æœ¯éƒ¨",
    "queryDate": "2025-09-04",
    "mealStatus": {
      "breakfast": {
        "isRegistered": true,
        "status": "confirmed",
        "statusText": "å·²ç¡®è®¤",
        "orderId": "order_123",
        "menuId": "menu_123",
        "menuName": "ä»Šæ—¥æ—©é¤",
        "dishes": [
          {
            "dishId": "dish_1",
            "dishName": "å°ç¬¼åŒ…",
            "dishImage": "https://example.com/image1.jpg",
            "originalPrice": 10.00,
            "menuPrice": 8.00,
            "sort": 1
          },
          {
            "dishId": "dish_2",
            "dishName": "è±†æµ†",
            "dishImage": "https://example.com/image2.jpg",
            "originalPrice": 5.00,
            "menuPrice": 4.00,
            "sort": 2
          }
        ],
        "totalAmount": 12.00,
        "registerTime": "2025-09-04T08:30:00.000Z",
        "registrantName": "éƒ¨é—¨ç®¡ç†å‘˜",
        "remark": "å¤‡æ³¨ä¿¡æ¯"
      },
      "lunch": {
        "isRegistered": true,
        "status": "pending",
        "statusText": "å¾…ç¡®è®¤",
        "orderId": "order_124",
        "menuId": "menu_124",
        "menuName": "ä»Šæ—¥åˆé¤",
        "dishes": [
          {
            "dishId": "dish_3",
            "dishName": "å®«ä¿é¸¡ä¸",
            "dishImage": "https://example.com/image3.jpg",
            "originalPrice": 18.00,
            "menuPrice": 15.00,
            "sort": 1
          }
        ],
        "totalAmount": 15.00,
        "registerTime": "2025-09-04T10:15:00.000Z",
        "registrantName": "éƒ¨é—¨ç®¡ç†å‘˜",
        "remark": ""
      },
      "dinner": {
        "isRegistered": false,
        "status": null,
        "statusText": "æœªæŠ¥é¤",
        "orderId": null,
        "menuId": null,
        "menuName": null,
        "dishes": [],
        "totalAmount": 0.00,
        "registerTime": null,
        "registrantName": null,
        "remark": null
      }
    },
    "summary": {
      "totalRegistered": 2,
      "totalAmount": 27.00,
      "confirmedCount": 1,
      "pendingCount": 1,
      "unregisteredCount": 1
    },
    "availableMenus": {
      "breakfast": {
        "menuId": "menu_123",
        "menuName": "ä»Šæ—¥æ—©é¤",
        "publishStatus": "published",
        "dishes": [
          {
            "dishId": "dish_1",
            "dishName": "å°ç¬¼åŒ…",
            "dishImage": "https://example.com/image1.jpg",
            "originalPrice": 10.00,
            "menuPrice": 8.00,
            "sort": 1
          }
        ]
      },
      "lunch": {
        "menuId": "menu_124",
        "menuName": "ä»Šæ—¥åˆé¤",
        "publishStatus": "published",
        "dishes": [
          {
            "dishId": "dish_3",
            "dishName": "å®«ä¿é¸¡ä¸",
            "dishImage": "https://example.com/image3.jpg",
            "originalPrice": 18.00,
            "menuPrice": 15.00,
            "sort": 1
          }
        ]
      },
      "dinner": {
        "menuId": null,
        "menuName": null,
        "publishStatus": null,
        "dishes": []
      }
    }
  }
}
```

### é”™è¯¯å“åº”

#### 400 - å‚æ•°é”™è¯¯
```json
{
  "success": false,
  "message": "æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨YYYY-MM-DDæ ¼å¼",
  "code": "400",
  "timestamp": "2025-09-04T10:15:08.638Z"
}
```

#### 401 - æœªæˆæƒ
```json
{
  "success": false,
  "message": "æœªæˆæƒè®¿é—®",
  "code": "401",
  "timestamp": "2025-09-04T10:15:08.638Z"
}
```

#### 404 - ç”¨æˆ·ä¸å­˜åœ¨
```json
{
  "success": false,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨",
  "code": "404",
  "timestamp": "2025-09-04T10:15:08.638Z"
}
```

#### 500 - æœåŠ¡å™¨é”™è¯¯
```json
{
  "success": false,
  "message": "è·å–ä¸ªäººæŠ¥é¤çŠ¶æ€å¤±è´¥",
  "code": "500",
  "timestamp": "2025-09-04T10:15:08.638Z"
}
```

## ğŸ“Š æ•°æ®ç»“æ„è¯´æ˜

### mealStatus å¯¹è±¡

æ¯ä¸ªé¤æ¬¡ï¼ˆbreakfast/lunch/dinnerï¼‰åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| isRegistered | boolean | æ˜¯å¦å·²æŠ¥é¤ |
| status | string\|null | æŠ¥é¤çŠ¶æ€ï¼špending/confirmed/completed/cancelled |
| statusText | string | çŠ¶æ€æ–‡æœ¬ï¼šå¾…ç¡®è®¤/å·²ç¡®è®¤/å·²å®Œæˆ/å·²å–æ¶ˆ/æœªæŠ¥é¤ |
| orderId | string\|null | è®¢å•ID |
| menuId | string\|null | èœå•ID |
| menuName | string\|null | èœå•åç§° |
| dishes | array | èœå“åˆ—è¡¨ |
| totalAmount | number | æ€»é‡‘é¢ |
| registerTime | string\|null | æŠ¥é¤æ—¶é—´ |
| registrantName | string\|null | æŠ¥é¤äººå§“å |
| remark | string\|null | å¤‡æ³¨ä¿¡æ¯ |

### dishes æ•°ç»„

æ¯ä¸ªèœå“åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| dishId | string | èœå“ID |
| dishName | string | èœå“åç§° |
| dishImage | string | èœå“å›¾ç‰‡URL |
| originalPrice | number | åŸå§‹ä»·æ ¼ |
| menuPrice | number | èœå•ä»·æ ¼ |
| sort | number | æ’åº |

### summary å¯¹è±¡

æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯ï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| totalRegistered | number | å·²æŠ¥é¤é¤æ¬¡æ•°é‡ |
| totalAmount | number | æ€»é‡‘é¢ |
| confirmedCount | number | å·²ç¡®è®¤æ•°é‡ |
| pendingCount | number | å¾…ç¡®è®¤æ•°é‡ |
| unregisteredCount | number | æœªæŠ¥é¤æ•°é‡ |

## ğŸ¨ å‰ç«¯ä½¿ç”¨ç¤ºä¾‹

### React ç»„ä»¶ç¤ºä¾‹

```jsx
import React, { useState, useEffect } from 'react';

const DiningCard = () => {
  const [diningStatus, setDiningStatus] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchPersonalDiningStatus();
  }, []);

  const fetchPersonalDiningStatus = async () => {
    try {
      const response = await fetch('/api/dining/personal-status', {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      });
      const data = await response.json();
      setDiningStatus(data.data);
    } catch (error) {
      console.error('è·å–æŠ¥é¤çŠ¶æ€å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  const renderMealCard = (mealType, mealData) => {
    const mealNames = {
      breakfast: 'æ—©é¤',
      lunch: 'åˆé¤',
      dinner: 'æ™šé¤'
    };

    return (
      <div className={`meal-card ${mealData.isRegistered ? 'registered' : 'unregistered'}`}>
        <div className="meal-header">
          <h3>{mealNames[mealType]}</h3>
          <span className={`status ${mealData.status}`}>
            {mealData.statusText}
          </span>
        </div>
        
        {mealData.isRegistered ? (
          <div className="meal-content">
            <div className="menu-info">
              <h4>{mealData.menuName}</h4>
              <p className="amount">Â¥{mealData.totalAmount}</p>
            </div>
            
            <div className="dishes">
              {mealData.dishes.map(dish => (
                <div key={dish.dishId} className="dish-item">
                  <img src={dish.dishImage} alt={dish.dishName} />
                  <span>{dish.dishName}</span>
                  <span className="price">Â¥{dish.menuPrice}</span>
                </div>
              ))}
            </div>
            
            <div className="meal-footer">
              <small>æŠ¥é¤äººï¼š{mealData.registrantName}</small>
              <small>æ—¶é—´ï¼š{new Date(mealData.registerTime).toLocaleString()}</small>
            </div>
          </div>
        ) : (
          <div className="no-registration">
            <p>æš‚æœªæŠ¥é¤</p>
            {diningStatus.availableMenus[mealType] && (
              <button className="register-btn">ç«‹å³æŠ¥é¤</button>
            )}
          </div>
        )}
      </div>
    );
  };

  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (!diningStatus) return <div>è·å–æ•°æ®å¤±è´¥</div>;

  return (
    <div className="dining-status">
      <div className="user-info">
        <h2>{diningStatus.userName}</h2>
        <p>{diningStatus.department} | {diningStatus.queryDate}</p>
      </div>
      
      <div className="summary">
        <div className="summary-item">
          <span>å·²æŠ¥é¤ï¼š{diningStatus.summary.totalRegistered}é¤</span>
        </div>
        <div className="summary-item">
          <span>æ€»é‡‘é¢ï¼šÂ¥{diningStatus.summary.totalAmount}</span>
        </div>
      </div>
      
      <div className="meal-cards">
        {renderMealCard('breakfast', diningStatus.mealStatus.breakfast)}
        {renderMealCard('lunch', diningStatus.mealStatus.lunch)}
        {renderMealCard('dinner', diningStatus.mealStatus.dinner)}
      </div>
    </div>
  );
};

export default DiningCard;
```

### CSS æ ·å¼ç¤ºä¾‹

```css
.dining-status {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.meal-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  margin-bottom: 20px;
  padding: 16px;
  background: #fff;
}

.meal-card.registered {
  border-left: 4px solid #4CAF50;
}

.meal-card.unregistered {
  border-left: 4px solid #f44336;
  background: #fafafa;
}

.meal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.status {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: bold;
}

.status.confirmed {
  background: #4CAF50;
  color: white;
}

.status.pending {
  background: #FF9800;
  color: white;
}

.status.unregistered {
  background: #f44336;
  color: white;
}

.dishes {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
  margin: 12px 0;
}

.dish-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  background: #f5f5f5;
  border-radius: 4px;
}

.dish-item img {
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 4px;
}

.summary {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
  padding: 16px;
  background: #e3f2fd;
  border-radius: 8px;
}

.no-registration {
  text-align: center;
  padding: 20px;
  color: #666;
}

.register-btn {
  background: #2196F3;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
}
```

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

1. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨å•æ¬¡æŸ¥è¯¢è·å–æ‰€æœ‰é¤æ¬¡ä¿¡æ¯ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°
2. **æ•°æ®å®Œæ•´æ€§**: å¤„ç†èœå•ä¸å­˜åœ¨ã€èœå“ä¿¡æ¯ç¼ºå¤±ç­‰æƒ…å†µ
3. **æƒé™æ§åˆ¶**: ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æŠ¥é¤çŠ¶æ€
4. **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé»˜è®¤å€¼è®¾ç½®
5. **ç¼“å­˜ç­–ç•¥**: å¯è€ƒè™‘ç¼“å­˜èœå•ä¿¡æ¯å‡å°‘æ•°æ®åº“æŸ¥è¯¢

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…

- å“åº”å¼è®¾è®¡é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- å¡ç‰‡å¼å¸ƒå±€ä¾¿äºæ»‘åŠ¨æµè§ˆ
- çŠ¶æ€é¢œè‰²åŒºåˆ†ä¾¿äºå¿«é€Ÿè¯†åˆ«
- æ”¯æŒå¿«é€Ÿæ“ä½œï¼ˆå¦‚å–æ¶ˆæŠ¥é¤ã€é‡æ–°æŠ¥é¤ç­‰ï¼‰

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æ­£å¸¸æƒ…å†µæµ‹è¯•
1. ç”¨æˆ·å·²æŠ¥æ—©é¤å’Œåˆé¤ï¼ŒæœªæŠ¥æ™šé¤
2. ç”¨æˆ·æœªæŠ¥ä»»ä½•é¤æ¬¡
3. ç”¨æˆ·æ‰€æœ‰é¤æ¬¡éƒ½å·²æŠ¥é¤

### è¾¹ç•Œæƒ…å†µæµ‹è¯•
1. æŸ¥è¯¢ä¸å­˜åœ¨çš„æ—¥æœŸ
2. ç”¨æˆ·ä¸å­˜åœ¨
3. èœå•ä¿¡æ¯ç¼ºå¤±
4. èœå“ä¿¡æ¯ç¼ºå¤±

### é”™è¯¯æƒ…å†µæµ‹è¯•
1. æ— æ•ˆçš„æ—¥æœŸæ ¼å¼
2. ç¼ºå°‘è®¤è¯Token
3. æ•°æ®åº“è¿æ¥å¤±è´¥
