# 个人报餐状态接口设计

## 🎯 接口目标
为前端提供个人当天的报餐状态信息，用于生成用餐卡片，包含早中晚三个餐次的报餐情况。

## 📊 数据结构设计

### 接口路径
```
GET /api/dining/personal-status?date=2025-09-04
```

### 请求参数
- `date` (可选): 查询日期，默认为今天
- 需要用户认证Token

### 响应数据结构
```json
{
  "success": true,
  "message": "获取个人报餐状态成功",
  "data": {
    "userId": "user_123",
    "userName": "张三",
    "department": "技术部",
    "queryDate": "2025-09-04",
    "mealStatus": {
      "breakfast": {
        "isRegistered": true,
        "status": "confirmed",
        "statusText": "已确认",
        "orderId": "order_123",
        "menuId": "menu_123",
        "menuName": "今日早餐",
        "dishes": [
          {
            "dishId": "dish_1",
            "dishName": "小笼包",
            "price": 8.00,
            "image": "https://example.com/image1.jpg"
          }
        ],
        "totalAmount": 8.00,
        "registerTime": "2025-09-04T08:30:00.000Z",
        "registrantName": "部门管理员",
        "remark": "备注信息"
      },
      "lunch": {
        "isRegistered": true,
        "status": "pending",
        "statusText": "待确认",
        "orderId": "order_124",
        "menuId": "menu_124",
        "menuName": "今日午餐",
        "dishes": [
          {
            "dishId": "dish_2",
            "dishName": "宫保鸡丁",
            "price": 15.00,
            "image": "https://example.com/image2.jpg"
          }
        ],
        "totalAmount": 15.00,
        "registerTime": "2025-09-04T10:15:00.000Z",
        "registrantName": "部门管理员",
        "remark": ""
      },
      "dinner": {
        "isRegistered": false,
        "status": null,
        "statusText": "未报餐",
        "orderId": null,
        "menuId": null,
        "menuName": null,
        "dishes": [],
        "totalAmount": 0.00,
        "registerTime": null,
        "registrantName": null,
        "remark": null
      }
    },
    "summary": {
      "totalRegistered": 2,
      "totalAmount": 23.00,
      "confirmedCount": 1,
      "pendingCount": 1,
      "unregisteredCount": 1
    },
    "availableMenus": {
      "breakfast": {
        "menuId": "menu_123",
        "menuName": "今日早餐",
        "publishStatus": "published",
        "dishes": [...]
      },
      "lunch": {
        "menuId": "menu_124", 
        "menuName": "今日午餐",
        "publishStatus": "published",
        "dishes": [...]
      },
      "dinner": {
        "menuId": null,
        "menuName": null,
        "publishStatus": null,
        "dishes": []
      }
    }
  }
}
```

## 🔍 业务逻辑

### 1. 报餐状态判断
- 查询 `dining_orders` 表中 `memberIds` JSON字段是否包含当前用户ID
- 根据 `status` 字段判断报餐状态：
  - `pending`: 待确认
  - `confirmed`: 已确认  
  - `completed`: 已完成
  - `cancelled`: 已取消

### 2. 菜单信息获取
- 通过 `menuId` 关联 `menus` 表获取菜单详情
- 通过 `menu_dishes` 表获取菜品列表

### 3. 验证记录查询
- 查询 `dining_verifications` 表获取用餐验证记录
- 用于判断是否已经用餐

## 🎨 前端使用场景

### 用餐卡片展示
```javascript
// 早餐卡片
if (data.mealStatus.breakfast.isRegistered) {
  if (data.mealStatus.breakfast.status === 'confirmed') {
    // 显示已确认的早餐卡片
    // 包含菜品信息、价格、状态等
  } else if (data.mealStatus.breakfast.status === 'pending') {
    // 显示待确认的早餐卡片
  }
} else {
  // 显示未报餐状态
  // 可能显示可用的早餐菜单供选择
}
```

### 状态指示器
- ✅ 已确认报餐
- ⏳ 待确认报餐  
- ❌ 未报餐
- 🍽️ 已用餐（通过验证记录判断）

## 🔧 技术实现要点

1. **性能优化**: 使用单次查询获取所有餐次信息
2. **数据完整性**: 处理菜单不存在、菜品信息缺失等情况
3. **权限控制**: 用户只能查看自己的报餐状态
4. **缓存策略**: 可考虑缓存菜单信息减少数据库查询
5. **错误处理**: 完善的异常处理和默认值设置

## 📱 移动端适配

- 响应式设计适配不同屏幕尺寸
- 卡片式布局便于滑动浏览
- 状态颜色区分便于快速识别
- 支持快速操作（如取消报餐、重新报餐等）
