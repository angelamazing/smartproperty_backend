# APIæ¥å£500é”™è¯¯è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°

è®¿é—® `/api/admin/system-stats` æ¥å£æ—¶å‡ºç°500é”™è¯¯ï¼š
```json
{
    "success": false,
    "message": "è·å–ç³»ç»Ÿç»Ÿè®¡æ•°æ®å¤±è´¥",
    "code": "500",
    "timestamp": "2025-08-27T10:36:03.981Z"
}
```

## é—®é¢˜åˆ†æ

### 1. åˆæ­¥è¯Šæ–­
- âœ… æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- âœ… ç”¨æˆ·è®¤è¯tokenæœ‰æ•ˆ
- âœ… adminService.getSystemStats æ–¹æ³•æœ¬èº«å·¥ä½œæ­£å¸¸

### 2. æµ‹è¯•ç»“æœ

**ç›´æ¥æµ‹è¯•adminServiceï¼š**
```bash
node debug-admin-api.js
```
è¾“å‡ºï¼š
```
âœ… ç³»ç»Ÿç»Ÿè®¡æ•°æ®: {
  "totalUsers": 2,
  "todayOrders": 2,
  "totalVenues": 3,
  "todayReservations": 0,
  "monthlyGrowth": {
    "users": 0,
    "orders": 8.7,
    "reservations": 12.3
  }
}
```

**HTTPè¯·æ±‚æµ‹è¯•ï¼š**
- ç™»å½•æˆåŠŸ âœ…
- è·å–tokenæˆåŠŸ âœ…
- è®¿é—®adminæ¥å£å¤±è´¥ âŒ (500é”™è¯¯)

## å·²è§£å†³çš„é—®é¢˜

### 1. æ•°æ®åº“è¡¨ç¼ºå¤±
- **é—®é¢˜ï¼š** `Table 'smart_property.users' doesn't exist`
- **è§£å†³ï¼š** è¿è¡Œ `node scripts/initDatabase-complete.js init`
- **çŠ¶æ€ï¼š** âœ… å·²è§£å†³

### 2. å­—æ®µåä¸åŒ¹é…
- **é—®é¢˜ï¼š** SQLæŸ¥è¯¢ä¸­ä½¿ç”¨äº†é”™è¯¯çš„çŠ¶æ€å€¼
- **ä¿®å¤ï¼š** å°† `status = "active"` æ”¹ä¸º `status = "open"` (venuesè¡¨)
- **çŠ¶æ€ï¼š** âœ… å·²è§£å†³

### 3. æµ‹è¯•ç”¨æˆ·ç¼ºå¤±
- **é—®é¢˜ï¼š** ç¼ºå°‘ç®¡ç†å‘˜æµ‹è¯•ç”¨æˆ·
- **è§£å†³ï¼š** è¿è¡Œ `node scripts/create-test-admin.js`
- **çŠ¶æ€ï¼š** âœ… å·²è§£å†³

## å½“å‰çŠ¶æ€

### âœ… æ­£å¸¸å·¥ä½œçš„åŠŸèƒ½
1. æ•°æ®åº“è¿æ¥
2. è¡¨ç»“æ„å®Œæ•´
3. æµ‹è¯•ç”¨æˆ·åˆ›å»º
4. JWTè®¤è¯
5. AdminServiceé€»è¾‘

### âŒ ä»å­˜åœ¨çš„é—®é¢˜
1. HTTPè¯·æ±‚å¤„ç†é“¾ä¸­çš„æŸä¸ªç¯èŠ‚å¯¼è‡´500é”™è¯¯
2. å¯èƒ½æ˜¯ä¸­é—´ä»¶æ‰§è¡Œé¡ºåºæˆ–é”™è¯¯å¤„ç†é—®é¢˜

## æµ‹è¯•å‡­æ®

### ç³»ç»Ÿç®¡ç†å‘˜
- æ‰‹æœºå·ï¼š`13800000002`
- è§’è‰²ï¼š`sys_admin`
- çŠ¶æ€ï¼šâœ… å¯ä»¥æ­£å¸¸ç™»å½•å¹¶è·å–token

### éƒ¨é—¨ç®¡ç†å‘˜
- æ‰‹æœºå·ï¼š`13800000001`
- è§’è‰²ï¼š`dept_admin`
- çŠ¶æ€ï¼šâœ… å¯ä»¥æ­£å¸¸ç™»å½•å¹¶è·å–token

## æ¨èè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ç®€åŒ–é”™è¯¯å¤„ç†
ç§»é™¤å¤æ‚çš„ä¸­é—´ä»¶é“¾ï¼Œç›´æ¥åœ¨controllerä¸­å¤„ç†è®¤è¯å’Œä¸šåŠ¡é€»è¾‘ã€‚

### æ–¹æ¡ˆ2: è¯¦ç»†æ—¥å¿—æ’æŸ¥
åœ¨æ¯ä¸ªä¸­é—´ä»¶ä¸­æ·»åŠ è¯¦ç»†æ—¥å¿—ï¼Œè·Ÿè¸ªè¯·æ±‚æ‰§è¡Œè·¯å¾„ã€‚

### æ–¹æ¡ˆ3: é‡æ„è®¤è¯æµç¨‹
ç®€åŒ–è®¤è¯ä¸­é—´ä»¶ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ã€‚

## ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¯ä»¥åˆ›å»ºä¸€ä¸ªç›´æ¥çš„APIç«¯ç‚¹ç»•è¿‡ä¸­é—´ä»¶è¿›è¡Œæµ‹è¯•ï¼š

```javascript
// åœ¨routes/admin.jsä¸­æ·»åŠ 
router.get('/test-stats', async (req, res) => {
  try {
    const connection = await mysql.createConnection(config.database);
    const stats = await adminService.getSystemStats(connection);
    await connection.end();
    res.json({ success: true, data: stats });
  } catch (error) {
    res.status(500).json({ success: false, message: error.message });
  }
});
```

## æ€»ç»“

- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ âœ… æ­£å¸¸
- æ•°æ®åº“å’Œæ•°æ® âœ… æ­£å¸¸  
- è®¤è¯æœºåˆ¶ âœ… åŸºæœ¬æ­£å¸¸
- HTTPå¤„ç†é“¾ âŒ å­˜åœ¨é—®é¢˜

éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•HTTPè¯·æ±‚å¤„ç†æµç¨‹ä¸­çš„å…·ä½“é”™è¯¯ç‚¹ã€‚

---

**è°ƒè¯•æ—¶é—´ï¼š** 2025-08-27 10:45:00  
**é—®é¢˜çŠ¶æ€ï¼š** ğŸ” éœ€è¦ç»§ç»­è°ƒè¯•  
**ä¼˜å…ˆçº§ï¼š** ğŸ”´ é«˜
