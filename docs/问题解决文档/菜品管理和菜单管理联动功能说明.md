# 菜品管理和菜单管理联动功能说明

## 📋 功能概述

本功能实现了菜品管理和菜单管理的完整联动，让管理员可以在发布菜单时选择已有菜品，并支持自定义价格和排序。

## 🏗️ 系统架构

### 后端架构
- **服务层**: `adminService.js` - 包含菜单菜品管理的核心业务逻辑
- **控制器层**: `adminController.js` - 处理HTTP请求和响应
- **路由层**: `routes/admin.js` - 定义API接口路由
- **数据库**: MySQL 8.0+ - 存储菜品和菜单数据

### 数据表结构
- `dishes` - 菜品信息表
- `dish_categories` - 菜品分类表
- `menus` - 菜单信息表
- `menu_dishes` - 菜单菜品关联表

## 🔌 API接口

### 1. 获取可用菜品列表
```http
GET /api/admin/dishes/available
```

**查询参数:**
- `pageSize` (可选): 每页数量，默认100
- `categoryId` (可选): 菜品分类ID
- `keyword` (可选): 搜索关键词
- `status` (可选): 菜品状态，默认'active'

**响应示例:**
```json
{
  "success": true,
  "message": "获取可用菜品成功",
  "data": [
    {
      "_id": "dish-001",
      "name": "宫保鸡丁",
      "description": "经典川菜，口感麻辣鲜香",
      "price": 28.00,
      "categoryId": "cat-001",
      "categoryName": "川菜",
      "image": "dish-image-url",
      "calories": 320,
      "protein": 25.5,
      "fat": 18.2,
      "carbohydrate": 12.8,
      "tags": ["麻辣", "经典", "川菜"],
      "isRecommended": true
    }
  ]
}
```

### 2. 获取菜单菜品列表
```http
GET /api/admin/dishes/menu/:menuId/dishes
```

**路径参数:**
- `menuId`: 菜单ID

**响应示例:**
```json
{
  "success": true,
  "message": "获取菜单菜品成功",
  "data": [
    {
      "_id": "md-001",
      "menuId": "menu-001",
      "dishId": "dish-001",
      "price": 28.00,
      "sort": 1,
      "dishName": "宫保鸡丁",
      "dishDescription": "经典川菜，口感麻辣鲜香",
      "dishImage": "dish-image-url",
      "categoryName": "川菜"
    }
  ]
}
```

### 3. 设置菜单菜品
```http
POST /api/admin/dishes/menu/:menuId/dishes
```

**路径参数:**
- `menuId`: 菜单ID

**请求体:**
```json
{
  "dishItems": [
    {
      "dishId": "dish-001",
      "price": 28.00,
      "sort": 1
    },
    {
      "dishId": "dish-002",
      "price": 32.00,
      "sort": 2
    }
  ]
}
```

**响应示例:**
```json
{
  "success": true,
  "message": "菜单菜品设置成功",
  "data": {
    "success": true,
    "message": "菜单菜品设置成功"
  }
}
```

## 🚀 使用流程

### 1. 菜品管理
1. **创建菜品**: 在菜品管理模块创建新菜品
2. **设置分类**: 为菜品分配适当的分类
3. **上传图片**: 添加菜品图片
4. **设置标签**: 添加菜品标签，便于搜索和筛选

### 2. 菜单发布
1. **选择日期和餐次**: 选择要发布的日期和餐次类型
2. **选择菜品**: 从可用菜品列表中选择要包含的菜品
3. **自定义价格**: 可以为菜单中的菜品设置特殊价格
4. **设置排序**: 调整菜品在菜单中的显示顺序
5. **保存草稿**: 先保存为草稿，检查无误后再发布
6. **发布菜单**: 正式发布菜单

### 3. 菜单管理
1. **查看菜单**: 查看已发布的菜单详情
2. **编辑菜品**: 修改菜单中的菜品、价格或排序
3. **撤回菜单**: 如需要，可以撤回已发布的菜单

## 💡 最佳实践

### 菜品管理
- 为菜品设置清晰的分类，便于管理和查找
- 使用有意义的标签，提高搜索效率
- 定期更新菜品图片和描述
- 设置合理的价格策略

### 菜单管理
- 合理搭配菜品，注意营养均衡
- 根据季节和节日调整菜单内容
- 设置合理的菜品数量，避免过多选择
- 定期分析菜单效果，优化菜品组合

### 数据维护
- 定期清理无效的菜品数据
- 及时更新菜品状态（上架/下架）
- 备份重要的菜单数据
- 监控菜品使用频率，优化库存

## 🔧 故障排除

### 常见问题
1. **菜品无法选择**: 检查菜品状态是否为'active'
2. **菜单保存失败**: 验证菜品ID是否存在
3. **价格显示异常**: 检查价格字段格式
4. **排序不生效**: 确认sort字段值是否正确

### 调试方法
1. 查看后端日志，定位错误信息
2. 使用测试脚本验证API功能
3. 检查数据库表结构和数据完整性
4. 验证API参数格式和权限设置

## 📚 相关文档
- [菜品管理接口文档](./接口文档/07-菜品管理接口.md)
- [角色管理接口文档](./接口文档/08-角色管理接口.md)
- [系统API文档](./API接口文档.md)
- [数据库结构说明](./数据库结构说明.md)

## 🎯 后续优化方向
1. **智能推荐**: 基于历史数据推荐菜品组合
2. **营养分析**: 自动计算菜单的营养价值
3. **成本控制**: 集成成本管理，优化定价策略
4. **用户反馈**: 收集用户对菜单的评价和建议
5. **移动端支持**: 开发移动端管理应用

---

*最后更新: 2025-08-30*
*版本: 1.0.0*
