# æ•°æ®åº“é—®é¢˜è§£å†³æ€»ç»“

## ğŸš¨ é‡åˆ°çš„é—®é¢˜

### é—®é¢˜1ï¼šPrepared Statement ä¸æ”¯æŒDDL
```
This command is not supported in the prepared statement protocol yet
```

### é—®é¢˜2ï¼šUnknown column 'code' 
```
Unknown column 'code' in 'field list'
```

## ğŸ” é—®é¢˜åˆ†æ

### é—®é¢˜1åŸå› 
- `CREATE DATABASE`ã€`USE`ã€`SHOW TABLES`ç­‰DDLè¯­å¥ä¸èƒ½åœ¨prepared statementä¸­æ‰§è¡Œ
- éœ€è¦ä½¿ç”¨ `connection.query()` è€Œä¸æ˜¯ `connection.execute()`

### é—®é¢˜2åŸå› 
- è¡¨åˆ›å»ºå¤±è´¥æˆ–ä¸å®Œæ•´ï¼Œå¯¼è‡´æŸäº›å­—æ®µç¼ºå¤±
- æ’å…¥æ•°æ®æ—¶å¼•ç”¨äº†ä¸å­˜åœ¨çš„å­—æ®µ

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤1ï¼šæ›´æ–°æ‰€æœ‰æ•°æ®åº“æ“ä½œæ–¹æ³•

**ä¿®æ”¹å‰ï¼š**
```javascript
await connection.execute('CREATE DATABASE ...');
await connection.execute('SHOW TABLES');
await connection.execute('INSERT INTO ...');
```

**ä¿®æ”¹åï¼š**
```javascript
await connection.query('CREATE DATABASE ...');
await connection.query('SHOW TABLES');
await connection.query('INSERT INTO ...');
```

### ä¿®å¤2ï¼šåˆ›å»ºå¿«é€Ÿä¿®å¤è„šæœ¬

åˆ›å»ºäº† `scripts/quick-fix-db.js` ä¸“é—¨å¤„ç†è¿™ç±»é—®é¢˜ï¼š
- æ£€æŸ¥å’Œä¿®å¤è¡¨ç»“æ„
- æ·»åŠ ç¼ºå¤±çš„å­—æ®µ
- éªŒè¯ä¿®å¤ç»“æœ

## ğŸ› ï¸ å·²ä¿®å¤çš„æ–‡ä»¶

### 1. scripts/initDatabase-complete.js
- âœ… `createDatabase()` - æ”¹ç”¨ query() æ–¹æ³•
- âœ… `createTables()` - æ”¹ç”¨ query() æ–¹æ³•  
- âœ… `insertSampleData()` - æ”¹ç”¨ query() æ–¹æ³•
- âœ… `verifyDatabase()` - æ”¹ç”¨ query() æ–¹æ³•
- âœ… `cleanDatabase()` - æ”¹ç”¨ query() æ–¹æ³•

### 2. scripts/test-complete-system.js
- âœ… `testDatabaseOperations()` - æ”¹ç”¨ query() æ–¹æ³•

### 3. æ–°å¢æ–‡ä»¶
- âœ… `scripts/quick-fix-db.js` - ä¸“é—¨çš„ä¿®å¤è„šæœ¬
- âœ… `scripts/initDatabase-simple.js` - ç®€åŒ–çš„åˆå§‹åŒ–è„šæœ¬

## ğŸš€ æ¨èä½¿ç”¨é¡ºåº

### æ–¹æ¡ˆAï¼šå¿«é€Ÿä¿®å¤ï¼ˆæ¨èï¼‰
```bash
# 1. å¿«é€Ÿä¿®å¤æ•°æ®åº“
npm run quick-fix-db

# 2. å¯åŠ¨æœåŠ¡
npm run dev  

# 3. æµ‹è¯•æ¥å£
npm run test-interfaces
```

### æ–¹æ¡ˆBï¼šç®€åŒ–åˆå§‹åŒ–
```bash
# 1. ç®€åŒ–åˆå§‹åŒ–
npm run init-db-simple

# 2. å¯åŠ¨æœåŠ¡å¹¶æµ‹è¯•
npm run dev
npm run test-interfaces
```

### æ–¹æ¡ˆCï¼šå®Œæ•´åˆå§‹åŒ–
```bash
# 1. å®Œæ•´åˆå§‹åŒ–ï¼ˆä¿®å¤åï¼‰
npm run init-db-complete

# 2. éªŒè¯æ•°æ®åº“
npm run verify-db

# 3. å®Œæ•´æµ‹è¯•
npm run test-system
```

## ğŸ“‹ éªŒè¯æ£€æŸ¥æ¸…å•

### æ•°æ®åº“ç»“æ„æ£€æŸ¥
```sql
-- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
SHOW DATABASES LIKE 'smart_property';

-- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
USE smart_property;
SHOW TABLES;

-- æ£€æŸ¥ç”¨æˆ·è¡¨å­—æ®µ
DESCRIBE users;

-- ç¡®è®¤æµ‹è¯•å­—æ®µå­˜åœ¨
SHOW COLUMNS FROM users WHERE Field IN ('isTestUser', 'isAdminTest', 'isSysAdminTest');
```

### æ¥å£åŠŸèƒ½æ£€æŸ¥
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# æµ‹è¯•ç™»å½•æ¥å£
curl -X POST http://localhost:3000/api/auth/test-login-admin

# åº”è¯¥è¿”å›æˆåŠŸå“åº”è€Œä¸æ˜¯æ•°æ®åº“é”™è¯¯
```

## ğŸ”§ æ•…éšœæ’æŸ¥æ­¥éª¤

### 1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
```bash
mysql -h mysql-demo-mysql.ns-gpaauglf.svc -u root -p54bxhv99 -e "SELECT 1"
```

### 2. æ£€æŸ¥é…ç½®æ–‡ä»¶
```bash
cat config/database.js | grep -A 10 database:
```

### 3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```bash
tail -f logs/error.log
tail -f logs/combined.log
```

### 4. è¿è¡Œä¿®å¤è„šæœ¬
```bash
npm run quick-fix-db
```

### 5. éªŒè¯ä¿®å¤ç»“æœ
```bash
npm run verify-db
npm run test-interfaces
```

## ğŸ“ æŠ€æœ¯è¦ç‚¹æ€»ç»“

### MySQL2é©±åŠ¨çš„æ³¨æ„äº‹é¡¹
1. **DDLè¯­å¥**ï¼šå¿…é¡»ä½¿ç”¨ `query()` æ–¹æ³•
2. **DMLè¯­å¥**ï¼šå¯ä»¥ä½¿ç”¨ `query()` æˆ– `execute()`
3. **å‚æ•°åŒ–æŸ¥è¯¢**ï¼šæ¨èä½¿ç”¨ `query()` ä¿æŒä¸€è‡´æ€§

### æ•°æ®åº“åˆå§‹åŒ–æœ€ä½³å®è·µ
1. **åˆ†æ­¥æ‰§è¡Œ**ï¼šå…ˆåˆ›å»ºæ•°æ®åº“ï¼Œå†è¿æ¥æ•°æ®åº“
2. **é”™è¯¯å¤„ç†**ï¼šæ¯æ­¥éƒ½è¦æœ‰å®Œå–„çš„é”™è¯¯å¤„ç†
3. **éªŒè¯æœºåˆ¶**ï¼šåˆ›å»ºåè¦éªŒè¯è¡¨ç»“æ„å’Œæ•°æ®
4. **å¹‚ç­‰æ€§**ï¼šæ”¯æŒé‡å¤æ‰§è¡Œä¸å‡ºé”™

### å¤–é”®çº¦æŸå¤„ç†
1. **åˆ›å»ºé¡ºåº**ï¼šæŒ‰ä¾èµ–å…³ç³»åˆ›å»ºè¡¨
2. **åˆ é™¤é¡ºåº**ï¼šæŒ‰é€†ä¾èµ–å…³ç³»åˆ é™¤è¡¨
3. **çº¦æŸæ§åˆ¶**ï¼šå¿…è¦æ—¶ç¦ç”¨å¤–é”®æ£€æŸ¥

## ğŸ¯ é—®é¢˜é¢„é˜²

### å¼€å‘ç¯å¢ƒ
- ä½¿ç”¨å®¹å™¨åŒ–æ•°æ®åº“ç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§
- ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- å®šæœŸéªŒè¯æ•°æ®åº“ç»“æ„

### éƒ¨ç½²ç¯å¢ƒ  
- æä¾›å¤šç§åˆå§‹åŒ–é€‰é¡¹
- å®Œå–„çš„é”™è¯¯æ—¥å¿—è®°å½•
- æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

## ğŸ“ åç»­æ”¯æŒ

å¦‚æœè¿˜é‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š`logs/error.log` å’Œ `logs/combined.log`
2. **è¿è¡Œè¯Šæ–­**ï¼š`npm run verify-db`
3. **å¿«é€Ÿä¿®å¤**ï¼š`npm run quick-fix-db`
4. **é‡æ–°åˆå§‹åŒ–**ï¼š`npm run reset-db`

---

**æ€»ç»“**ï¼šé€šè¿‡å°†æ‰€æœ‰æ•°æ®åº“æ“ä½œä» `execute()` æ”¹ä¸º `query()` æ–¹æ³•ï¼Œè§£å†³äº†prepared statementä¸æ”¯æŒDDLè¯­å¥çš„é—®é¢˜ã€‚ç°åœ¨æ•°æ®åº“åˆå§‹åŒ–åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œäº†ã€‚
