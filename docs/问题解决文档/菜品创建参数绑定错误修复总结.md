# èœå“åˆ›å»ºå‚æ•°ç»‘å®šé”™è¯¯ä¿®å¤æ€»ç»“

## ğŸš¨ é—®é¢˜æè¿°

åœ¨åˆ›å»ºèœå“æ—¶é‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š
```
Bind parameters must not contain undefined. To pass SQL NULL specify JS null
```

## ğŸ” é—®é¢˜åˆ†æ

### é”™è¯¯åŸå› 
MySQL é©±åŠ¨è¦æ±‚ SQL å‚æ•°ä¸èƒ½åŒ…å« `undefined` å€¼ï¼Œå¿…é¡»ä½¿ç”¨ `null` ä»£æ›¿ã€‚åœ¨ `adminService.js` çš„ `createDish` æ–¹æ³•ä¸­ï¼ŒæŸäº›å¯é€‰å‚æ•°å¯èƒ½ä¸º `undefined`ï¼Œå¯¼è‡´å‚æ•°ç»‘å®šå¤±è´¥ã€‚

### é—®é¢˜ä½ç½®
- **æ–‡ä»¶**: `services/adminService.js`
- **æ–¹æ³•**: `createDish()` å’Œ `updateDish()`
- **é—®é¢˜**: ç›´æ¥ä½¿ç”¨ `undefined` å€¼ä½œä¸º SQL å‚æ•°

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ createDish æ–¹æ³•

**ä¿®å¤å‰**:
```javascript
await db.execute(
  `INSERT INTO dishes (...) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), ?)`,
  [
    dishId, name, categoryId, description, price, image, calories, protein,
    fat, carbohydrate, JSON.stringify(tags), status, isRecommended, createBy
  ]
);
```

**ä¿®å¤å**:
```javascript
// å¤„ç† undefined å€¼ï¼Œè½¬æ¢ä¸º null
const safeDescription = description || null;
const safeImage = image || null;
const safeCalories = calories !== undefined ? calories : null;
const safeProtein = protein !== undefined ? protein : null;
const safeFat = fat !== undefined ? fat : null;
const safeCarbohydrate = carbohydrate !== undefined ? carbohydrate : null;
const safeCreateBy = createBy || null;

await db.execute(
  `INSERT INTO dishes (...) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), ?)`,
  [
    dishId, 
    name, 
    categoryId, 
    safeDescription, 
    price || 0, 
    safeImage, 
    safeCalories, 
    safeProtein,
    safeFat, 
    safeCarbohydrate, 
    JSON.stringify(tags), 
    status, 
    isRecommended ? 1 : 0, 
    safeCreateBy
  ]
);
```

### 2. ä¿®å¤ updateDish æ–¹æ³•

**ä¿®å¤å‰**:
```javascript
allowedFields.forEach(field => {
  if (dishData[field] !== undefined) {
    updateFields.push(`${field} = ?`);
    updateValues.push(dishData[field]);
  }
});
```

**ä¿®å¤å**:
```javascript
allowedFields.forEach(field => {
  if (dishData[field] !== undefined) {
    updateFields.push(`${field} = ?`);
    // å¤„ç† undefined å€¼ï¼Œè½¬æ¢ä¸º null
    let value = dishData[field];
    if (value === undefined) {
      value = null;
    } else if (field === 'isRecommended') {
      value = value ? 1 : 0;
    }
    updateValues.push(value);
  }
});
```

## âœ… ä¿®å¤å†…å®¹

### 1. å‚æ•°å®‰å…¨å¤„ç†
- å°†æ‰€æœ‰ `undefined` å€¼è½¬æ¢ä¸º `null`
- ä¸ºæ•°å€¼ç±»å‹æä¾›é»˜è®¤å€¼ï¼ˆå¦‚ `price || 0`ï¼‰
- æ­£ç¡®å¤„ç†å¸ƒå°”å€¼ï¼ˆ`isRecommended ? 1 : 0`ï¼‰

### 2. å­—æ®µç±»å‹å¤„ç†
- **å­—ç¬¦ä¸²å­—æ®µ**: `description`, `image` â†’ `null` æˆ–åŸå€¼
- **æ•°å€¼å­—æ®µ**: `calories`, `protein`, `fat`, `carbohydrate` â†’ `null` æˆ–åŸå€¼
- **å¸ƒå°”å­—æ®µ**: `isRecommended` â†’ `1` æˆ– `0`
- **å¿…éœ€å­—æ®µ**: `name`, `categoryId`, `price` â†’ æä¾›é»˜è®¤å€¼

### 3. æ•°æ®åº“å…¼å®¹æ€§
- ç¡®ä¿æ‰€æœ‰å‚æ•°éƒ½ç¬¦åˆ MySQL æ•°æ®ç±»å‹è¦æ±‚
- é¿å… `undefined` å€¼å¯¼è‡´çš„å‚æ•°ç»‘å®šé”™è¯¯
- ä¿æŒæ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹
```javascript
const testDish = {
  name: "å—ç“œç‚’è¥¿çº¢æŸ¿",
  description: "æ— ",
  categoryId: "2",
  price: 13,
  calories: 121,
  protein: 2,
  fat: 34,
  carbohydrate: 4,
  isRecommended: false
};
```

### é¢„æœŸç»“æœ
- âœ… èœå“åˆ›å»ºæˆåŠŸ
- âœ… æ‰€æœ‰å‚æ•°æ­£ç¡®ç»‘å®š
- âœ… æ•°æ®åº“è®°å½•å®Œæ•´
- âœ… æ— å‚æ•°ç»‘å®šé”™è¯¯

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
```json
{
  "success": false,
  "message": "åˆ›å»ºèœå“å¤±è´¥",
  "error": "Bind parameters must not contain undefined. To pass SQL NULL specify JS null"
}
```

### ä¿®å¤å
```json
{
  "success": true,
  "message": "åˆ›å»ºèœå“æˆåŠŸ",
  "data": {
    "id": "dish-uuid",
    "name": "å—ç“œç‚’è¥¿çº¢æŸ¿",
    "price": 13,
    "status": "active"
  }
}
```

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### 1. å‚æ•°éªŒè¯
- æ£€æŸ¥æ‰€æœ‰å‚æ•°æ˜¯å¦ä¸º `undefined`
- æä¾›åˆé€‚çš„é»˜è®¤å€¼
- ç¡®ä¿æ•°æ®ç±»å‹æ­£ç¡®

### 2. æ•°æ®åº“å…¼å®¹
- ä½¿ç”¨ `null` è€Œä¸æ˜¯ `undefined`
- æ­£ç¡®å¤„ç†å¸ƒå°”å€¼è½¬æ¢
- ä¿æŒ SQL å‚æ•°ç±»å‹ä¸€è‡´

### 3. é”™è¯¯å¤„ç†
- å®Œå–„çš„å¼‚å¸¸æ•è·
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- æ•°æ®å›æ»šæœºåˆ¶

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å‚æ•°å¤„ç†
```javascript
// æ¨èåšæ³•
const safeValue = value !== undefined ? value : null;

// é¿å…åšæ³•
const unsafeValue = value; // å¯èƒ½æ˜¯ undefined
```

### 2. æ•°æ®åº“æ“ä½œ
```javascript
// æ¨èåšæ³•
const params = [
  requiredField,
  optionalField || null,
  booleanField ? 1 : 0
];

// é¿å…åšæ³•
const params = [
  requiredField,
  optionalField, // å¯èƒ½æ˜¯ undefined
  booleanField // å¯èƒ½æ˜¯ undefined
];
```

### 3. ç±»å‹è½¬æ¢
```javascript
// æ¨èåšæ³•
const safeNumber = typeof value === 'number' ? value : null;
const safeBoolean = typeof value === 'boolean' ? (value ? 1 : 0) : 0;

// é¿å…åšæ³•
const unsafeNumber = value; // å¯èƒ½æ˜¯ undefined
const unsafeBoolean = value; // å¯èƒ½æ˜¯ undefined
```

## ğŸ“ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼Œæˆ‘ä»¬è§£å†³äº†èœå“åˆ›å»ºæ¥å£ä¸­çš„å‚æ•°ç»‘å®šé”™è¯¯é—®é¢˜ï¼š

1. **é—®é¢˜æ ¹æº**: MySQL é©±åŠ¨ä¸æ”¯æŒ `undefined` å‚æ•°å€¼
2. **è§£å†³æ–¹æ¡ˆ**: å°†æ‰€æœ‰ `undefined` å€¼è½¬æ¢ä¸º `null` æˆ–åˆé€‚çš„é»˜è®¤å€¼
3. **ä¿®å¤èŒƒå›´**: `createDish` å’Œ `updateDish` ä¸¤ä¸ªæ–¹æ³•
4. **æµ‹è¯•éªŒè¯**: åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹éªŒè¯ä¿®å¤æ•ˆæœ

ç°åœ¨èœå“åˆ›å»ºæ¥å£å¯ä»¥æ­£å¸¸å¤„ç†åŒ…å«å¯é€‰å­—æ®µçš„æ•°æ®ï¼Œä¸å†å‡ºç°å‚æ•°ç»‘å®šé”™è¯¯ã€‚
