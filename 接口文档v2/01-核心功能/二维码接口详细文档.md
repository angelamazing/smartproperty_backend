# ğŸ“± äºŒç»´ç æ¥å£è¯¦ç»†æ–‡æ¡£

## ğŸ“– æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†äºŒç»´ç ç®¡ç†ç›¸å…³çš„æ‰€æœ‰APIæ¥å£ï¼ŒåŒ…æ‹¬äºŒç»´ç çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œæ‰«ç éªŒè¯åŠŸèƒ½ã€‚

**åŸºç¡€è·¯å¾„**: `/api/qr-scan`  
**è®¤è¯æ–¹å¼**: JWT Token  
**æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0  
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ

## ğŸ” è®¤è¯é…ç½®

### è¯·æ±‚å¤´è®¾ç½®
```javascript
const headers = {
  'Authorization': `Bearer ${token}`,
  'Content-Type': 'application/json'
};
```

### Tokenè·å–
```javascript
// ç™»å½•åè·å–token
const loginResponse = await fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ username, password })
});
const { data: { token } } = await loginResponse.json();
```

## ğŸ“± ç”¨æˆ·ç«¯æ¥å£

### 1. æ‰«ç å°±é¤ç™»è®°

**æ¥å£åœ°å€**: `POST /api/qr-scan/scan`

**åŠŸèƒ½æè¿°**: å¤„ç†ç”¨æˆ·æ‰«ç å°±é¤ç™»è®°è¯·æ±‚ï¼Œæ ¹æ®æ‰«ç æ—¶é—´è‡ªåŠ¨åˆ¤æ–­é¤æ¬¡

**æƒé™è¦æ±‚**: å·²ç™»å½•ç”¨æˆ·

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {your-jwt-token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "qrCode": "DINING_QR_MAIN_001",
  "scanTime": "2025-09-09T12:30:00.000Z"
}
```

**å‚æ•°è¯´æ˜**:
- `qrCode`: äºŒç»´ç æ ‡è¯†ï¼Œå¿…å¡«ï¼Œæœ€å¤§100å­—ç¬¦
- `scanTime`: æ‰«ç æ—¶é—´ï¼Œå¿…å¡«ï¼ŒISO 8601æ ¼å¼

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "ç™»è®°æˆåŠŸï¼[åˆé¤] 2025-09-09 12:30",
  "data": {
    "userId": "user-uuid",
    "userName": "å¼ ä¸‰",
    "mealType": "lunch",
    "mealTypeName": "åˆé¤",
    "diningDate": "2025-09-09",
    "scanTime": "2025-09-09 12:30:00",
    "qrCodeInfo": {
      "name": "é¤å…ä¸»å…¥å£äºŒç»´ç ",
      "location": "é¤å…ä¸»å…¥å£"
    }
  },
  "code": "200",
  "timestamp": "2025-09-09T12:30:00.000Z"
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "message": "æ‚¨å°šæœªæŠ¥é¤ï¼Œæ— æ³•è¿›è¡Œå°±é¤ç™»è®°",
  "error": "æ‚¨å°šæœªæŠ¥é¤ï¼Œæ— æ³•è¿›è¡Œå°±é¤ç™»è®°",
  "code": "400",
  "timestamp": "2025-09-09T12:30:00.000Z"
}
```

**å‰ç«¯è°ƒç”¨ç¤ºä¾‹**:
```javascript
async function scanQRCode(qrCode) {
  try {
    const response = await fetch('/api/qr-scan/scan', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        qrCode: qrCode,
        scanTime: new Date().toISOString()
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      console.log('æ‰«ç æˆåŠŸ:', result.message);
      return result.data;
    } else {
      console.error('æ‰«ç å¤±è´¥:', result.message);
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('æ‰«ç è¯·æ±‚å¤±è´¥:', error);
    throw error;
  }
}
```

### 2. è·å–ç”¨æˆ·å°±é¤ç™»è®°å†å²

**æ¥å£åœ°å€**: `GET /api/qr-scan/history`

**åŠŸèƒ½æè¿°**: è·å–ç”¨æˆ·çš„å†å²å°±é¤ç™»è®°è®°å½•

**æƒé™è¦æ±‚**: å·²ç™»å½•ç”¨æˆ·

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {your-jwt-token}
```

**è¯·æ±‚å‚æ•°**:
```
GET /api/qr-scan/history?date=2025-09-09&limit=20&offset=0
```

**å‚æ•°è¯´æ˜**:
- `date`: æŸ¥è¯¢æ—¥æœŸï¼Œå¯é€‰ï¼Œæ ¼å¼ï¼šYYYY-MM-DDï¼Œé»˜è®¤ä»Šæ—¥
- `limit`: æ¯é¡µæ•°é‡ï¼Œå¯é€‰ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100
- `offset`: åç§»é‡ï¼Œå¯é€‰ï¼Œé»˜è®¤0

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "è·å–å°±é¤ç™»è®°å†å²æˆåŠŸ",
  "data": [
    {
      "_id": "reg-uuid",
      "userId": "user-uuid",
      "userName": "å¼ ä¸‰",
      "qrCode": "DINING_QR_MAIN_001",
      "scanTime": "2025-09-09T12:30:00.000Z",
      "mealType": "lunch",
      "mealTypeName": "åˆé¤",
      "diningDate": "2025-09-09",
      "status": "success",
      "qrCodeInfo": {
        "name": "é¤å…ä¸»å…¥å£äºŒç»´ç ",
        "location": "é¤å…ä¸»å…¥å£"
      }
    }
  ],
  "pagination": {
    "total": 1,
    "limit": 20,
    "offset": 0,
    "hasMore": false
  },
  "code": "200",
  "timestamp": "2025-09-09T12:30:00.000Z"
}
```

**å‰ç«¯è°ƒç”¨ç¤ºä¾‹**:
```javascript
async function getUserDiningHistory(date = null, limit = 20, offset = 0) {
  try {
    const params = new URLSearchParams();
    if (date) params.append('date', date);
    params.append('limit', limit);
    params.append('offset', offset);
    
    const response = await fetch(`/api/qr-scan/history?${params}`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–å†å²è®°å½•å¤±è´¥:', error);
    throw error;
  }
}
```

### 3. è·å–å°±é¤ç»Ÿè®¡

**æ¥å£åœ°å€**: `GET /api/qr-scan/statistics`

**åŠŸèƒ½æè¿°**: è·å–æŒ‡å®šæ—¥æœŸçš„å°±é¤ç»Ÿè®¡æ•°æ®

**æƒé™è¦æ±‚**: å·²ç™»å½•ç”¨æˆ·

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {your-jwt-token}
```

**è¯·æ±‚å‚æ•°**:
```
GET /api/qr-scan/statistics?date=2025-09-09
```

**å‚æ•°è¯´æ˜**:
- `date`: ç»Ÿè®¡æ—¥æœŸï¼Œå¯é€‰ï¼Œæ ¼å¼ï¼šYYYY-MM-DDï¼Œé»˜è®¤ä»Šæ—¥

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "è·å–å°±é¤ç»Ÿè®¡æˆåŠŸ",
  "data": {
    "date": "2025-09-09",
    "statistics": {
      "breakfast": {
        "totalScans": 45,
        "uniqueUsers": 42,
        "successfulScans": 44,
        "failedScans": 1
      },
      "lunch": {
        "totalScans": 78,
        "uniqueUsers": 75,
        "successfulScans": 76,
        "failedScans": 2
      },
      "dinner": {
        "totalScans": 52,
        "uniqueUsers": 50,
        "successfulScans": 51,
        "failedScans": 1
      }
    },
    "summary": {
      "totalScans": 175,
      "uniqueUsers": 167,
      "successfulScans": 171,
      "failedScans": 4
    }
  },
  "code": "200",
  "timestamp": "2025-09-09T12:30:00.000Z"
}
```

## ğŸ”§ ç®¡ç†å‘˜æ¥å£

### 4. åˆ›å»ºäºŒç»´ç 

**æ¥å£åœ°å€**: `POST /api/qr-scan/qr-codes`

**åŠŸèƒ½æè¿°**: åˆ›å»ºæ–°çš„äºŒç»´ç 

**æƒé™è¦æ±‚**: éƒ¨é—¨ç®¡ç†å‘˜åŠä»¥ä¸Š

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {your-jwt-token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "name": "é¤å…ä¸»å…¥å£äºŒç»´ç ",
  "location": "é¤å…ä¸»å…¥å£",
  "description": "é¤å…ä¸»å…¥å£é€šç”¨äºŒç»´ç ï¼Œæ”¯æŒæ‰€æœ‰é¤æ¬¡ç™»è®°"
}
```

**å‚æ•°è¯´æ˜**:
- `name`: äºŒç»´ç åç§°ï¼Œå¿…å¡«ï¼Œ2-100å­—ç¬¦
- `location`: å¼ è´´ä½ç½®ï¼Œå¿…å¡«ï¼Œ2-200å­—ç¬¦
- `description`: æè¿°ä¿¡æ¯ï¼Œå¯é€‰ï¼Œæœ€å¤§500å­—ç¬¦

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "äºŒç»´ç åˆ›å»ºæˆåŠŸ",
  "data": {
    "qrId": "qr-uuid",
    "code": "DINING_QR_1705123456789_ABC123DEF",
    "message": "äºŒç»´ç åˆ›å»ºæˆåŠŸ"
  },
  "code": "200",
  "timestamp": "2025-09-09T12:30:00.000Z"
}
```

**å‰ç«¯è°ƒç”¨ç¤ºä¾‹**:
```javascript
async function createQRCode(name, location, description = '') {
  try {
    const response = await fetch('/api/qr-scan/qr-codes', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        name,
        location,
        description
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      console.log('äºŒç»´ç åˆ›å»ºæˆåŠŸ:', result.data.code);
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('åˆ›å»ºäºŒç»´ç å¤±è´¥:', error);
    throw error;
  }
}
```

### 5. è·å–äºŒç»´ç åˆ—è¡¨

**æ¥å£åœ°å€**: `GET /api/qr-scan/qr-codes`

**åŠŸèƒ½æè¿°**: è·å–äºŒç»´ç åˆ—è¡¨

**æƒé™è¦æ±‚**: éƒ¨é—¨ç®¡ç†å‘˜åŠä»¥ä¸Š

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {your-jwt-token}
```

**è¯·æ±‚å‚æ•°**:
```
GET /api/qr-scan/qr-codes?status=active&limit=50&offset=0
```

**å‚æ•°è¯´æ˜**:
- `status`: çŠ¶æ€ç­›é€‰ï¼Œå¯é€‰ï¼Œæšä¸¾å€¼ï¼šactive/inactive
- `limit`: æ¯é¡µæ•°é‡ï¼Œå¯é€‰ï¼Œé»˜è®¤100ï¼Œæœ€å¤§200
- `offset`: åç§»é‡ï¼Œå¯é€‰ï¼Œé»˜è®¤0

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "è·å–äºŒç»´ç åˆ—è¡¨æˆåŠŸ",
  "data": [
    {
      "_id": "qr-uuid",
      "code": "DINING_QR_MAIN_001",
      "name": "é¤å…ä¸»å…¥å£äºŒç»´ç ",
      "location": "é¤å…ä¸»å…¥å£",
      "description": "é¤å…ä¸»å…¥å£é€šç”¨äºŒç»´ç ï¼Œæ”¯æŒæ‰€æœ‰é¤æ¬¡ç™»è®°",
      "status": "active",
      "createTime": "2025-09-09T08:00:00.000Z",
      "updateTime": "2025-09-09T08:00:00.000Z"
    }
  ],
  "pagination": {
    "total": 1,
    "limit": 50,
    "offset": 0,
    "hasMore": false
  },
  "code": "200",
  "timestamp": "2025-09-09T12:30:00.000Z"
}
```

**å‰ç«¯è°ƒç”¨ç¤ºä¾‹**:
```javascript
async function getQRCodes(status = null, limit = 100, offset = 0) {
  try {
    const params = new URLSearchParams();
    if (status) params.append('status', status);
    params.append('limit', limit);
    params.append('offset', offset);
    
    const response = await fetch(`/api/qr-scan/qr-codes?${params}`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–äºŒç»´ç åˆ—è¡¨å¤±è´¥:', error);
    throw error;
  }
}
```

### 6. è·å–äºŒç»´ç è¯¦æƒ…

**æ¥å£åœ°å€**: `GET /api/qr-scan/qr-codes/:qrId`

**åŠŸèƒ½æè¿°**: è·å–æŒ‡å®šäºŒç»´ç çš„è¯¦ç»†ä¿¡æ¯å’Œä½¿ç”¨ç»Ÿè®¡

**æƒé™è¦æ±‚**: éƒ¨é—¨ç®¡ç†å‘˜åŠä»¥ä¸Š

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {your-jwt-token}
```

**è¯·æ±‚å‚æ•°**: è·¯å¾„å‚æ•°
- `qrId`: äºŒç»´ç ID

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "è·å–äºŒç»´ç è¯¦æƒ…æˆåŠŸ",
  "data": {
    "_id": "qr-uuid",
    "code": "DINING_QR_MAIN_001",
    "name": "é¤å…ä¸»å…¥å£äºŒç»´ç ",
    "location": "é¤å…ä¸»å…¥å£",
    "description": "é¤å…ä¸»å…¥å£é€šç”¨äºŒç»´ç ï¼Œæ”¯æŒæ‰€æœ‰é¤æ¬¡ç™»è®°",
    "status": "active",
    "createTime": "2025-09-09T08:00:00.000Z",
    "updateTime": "2025-09-09T08:00:00.000Z",
    "usageStats": {
      "totalScans": 150,
      "uniqueUsers": 120,
      "successfulScans": 145,
      "failedScans": 5
    }
  },
  "code": "200",
  "timestamp": "2025-09-09T12:30:00.000Z"
}
```

**å‰ç«¯è°ƒç”¨ç¤ºä¾‹**:
```javascript
async function getQRCodeDetail(qrId) {
  try {
    const response = await fetch(`/api/qr-scan/qr-codes/${qrId}`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–äºŒç»´ç è¯¦æƒ…å¤±è´¥:', error);
    throw error;
  }
}
```

### 7. ç”ŸæˆäºŒç»´ç å›¾ç‰‡

**æ¥å£åœ°å€**: `GET /api/qr-scan/qr-codes/:qrCode/image`

**åŠŸèƒ½æè¿°**: ç”ŸæˆæŒ‡å®šäºŒç»´ç çš„å›¾ç‰‡

**æƒé™è¦æ±‚**: å·²ç™»å½•ç”¨æˆ·

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {your-jwt-token}
```

**è¯·æ±‚å‚æ•°**: è·¯å¾„å‚æ•°
- `qrCode`: äºŒç»´ç æ ‡è¯†

**æŸ¥è¯¢å‚æ•°**:
- `width`: å›¾ç‰‡å®½åº¦ï¼Œå¯é€‰ï¼Œé»˜è®¤200
- `margin`: è¾¹è·ï¼Œå¯é€‰ï¼Œé»˜è®¤2

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "äºŒç»´ç å›¾ç‰‡ç”ŸæˆæˆåŠŸ",
  "data": {
    "qrCode": "DINING_QR_MAIN_001",
    "imageDataURL": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
    "width": 200,
    "margin": 2
  },
  "code": "200",
  "timestamp": "2025-09-09T12:30:00.000Z"
}
```

**å‰ç«¯è°ƒç”¨ç¤ºä¾‹**:
```javascript
async function generateQRCodeImage(qrCode, width = 200, margin = 2) {
  try {
    const response = await fetch(`/api/qr-scan/qr-codes/${qrCode}/image?width=${width}&margin=${margin}`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data.imageDataURL;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('ç”ŸæˆäºŒç»´ç å›¾ç‰‡å¤±è´¥:', error);
    throw error;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const qrImageDataURL = await generateQRCodeImage('DINING_QR_MAIN_001');
// åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºäºŒç»´ç å›¾ç‰‡
const img = document.createElement('img');
img.src = qrImageDataURL;
document.body.appendChild(img);
```

### 8. æ›´æ–°äºŒç»´ç çŠ¶æ€

**æ¥å£åœ°å€**: `PUT /api/qr-scan/qr-codes/:qrId/status`

**åŠŸèƒ½æè¿°**: æ›´æ–°äºŒç»´ç çš„å¯ç”¨/åœç”¨çŠ¶æ€

**æƒé™è¦æ±‚**: éƒ¨é—¨ç®¡ç†å‘˜åŠä»¥ä¸Š

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {your-jwt-token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**: è·¯å¾„å‚æ•°
- `qrId`: äºŒç»´ç ID

**è¯·æ±‚ä½“**:
```json
{
  "status": "inactive"
}
```

**å‚æ•°è¯´æ˜**:
- `status`: çŠ¶æ€ï¼Œå¿…å¡«ï¼Œæšä¸¾å€¼ï¼šactive/inactive

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "äºŒç»´ç çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": {
    "qrId": "qr-uuid",
    "status": "inactive"
  },
  "code": "200",
  "timestamp": "2025-09-09T12:30:00.000Z"
}
```

**å‰ç«¯è°ƒç”¨ç¤ºä¾‹**:
```javascript
async function updateQRCodeStatus(qrId, status) {
  try {
    const response = await fetch(`/api/qr-scan/qr-codes/${qrId}/status`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ status })
    });
    
    const result = await response.json();
    
    if (result.success) {
      console.log('äºŒç»´ç çŠ¶æ€æ›´æ–°æˆåŠŸ');
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('æ›´æ–°äºŒç»´ç çŠ¶æ€å¤±è´¥:', error);
    throw error;
  }
}
```

## ğŸ“‹ ä¸šåŠ¡è§„åˆ™

### æ‰«ç ç™»è®°è§„åˆ™

1. **æ—¶é—´é™åˆ¶**: åªæœ‰åœ¨å°±é¤æ—¶é—´å†…æ‰«ç æ‰èƒ½æˆåŠŸç™»è®°
   - æ—©é¤æ—¶é—´: 6:00-10:00
   - åˆé¤æ—¶é—´: 11:00-14:00
   - æ™šé¤æ—¶é—´: 17:00-20:00

2. **æŠ¥é¤éªŒè¯**: ç”¨æˆ·å¿…é¡»å…ˆæŠ¥é¤æ‰èƒ½è¿›è¡Œå°±é¤ç™»è®°
   - âš ï¸ **é‡è¦**: åªæœ‰éƒ¨é—¨ç®¡ç†å‘˜å¯ä»¥ä¸ºéƒ¨é—¨æˆå‘˜æŠ¥é¤
   - æ™®é€šç”¨æˆ·æ— æ³•è‡ªè¡ŒæŠ¥é¤ï¼Œéœ€è¦éƒ¨é—¨ç®¡ç†å‘˜ä»£ä¸ºæŠ¥é¤

3. **é‡å¤ç™»è®°**: åŒä¸€ç”¨æˆ·åŒä¸€é¤æ¬¡åªèƒ½ç™»è®°ä¸€æ¬¡

4. **äºŒç»´ç æœ‰æ•ˆæ€§**: åªæœ‰çŠ¶æ€ä¸º"active"çš„äºŒç»´ç æ‰èƒ½ä½¿ç”¨

### é”™è¯¯å¤„ç†

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| å½“å‰æ—¶é—´ä¸åœ¨å°±é¤æ—¶é—´å†… | æ‰«ç æ—¶é—´ä¸åœ¨è§„å®šå°±é¤æ—¶é—´å†… | åœ¨å°±é¤æ—¶é—´å†…æ‰«ç  |
| æ‚¨å°šæœªæŠ¥é¤ï¼Œæ— æ³•è¿›è¡Œå°±é¤ç™»è®° | ç”¨æˆ·æ²¡æœ‰æŠ¥é¤è®°å½• | è”ç³»éƒ¨é—¨ç®¡ç†å‘˜ä»£ä¸ºæŠ¥é¤ |
| æ‚¨å·²ç™»è®°è¿‡æœ¬æ¬¡å°±é¤ | ç”¨æˆ·å·²ç»ç™»è®°è¿‡è¯¥é¤æ¬¡ | æ— éœ€é‡å¤ç™»è®° |
| äºŒç»´ç æ— æ•ˆæˆ–å·²åœç”¨ | äºŒç»´ç ä¸å­˜åœ¨æˆ–å·²åœç”¨ | ä½¿ç”¨æœ‰æ•ˆçš„äºŒç»´ç  |
| ç”¨æˆ·ä¸å­˜åœ¨æˆ–å·²è¢«ç¦ç”¨ | ç”¨æˆ·è´¦å·å¼‚å¸¸ | è”ç³»ç®¡ç†å‘˜æ£€æŸ¥è´¦å·çŠ¶æ€ |

## ğŸ¯ å›ºå®šäºŒç»´ç 

### é»˜è®¤äºŒç»´ç 

ç³»ç»Ÿåˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹å›ºå®šäºŒç»´ç ï¼š

| äºŒç»´ç æ ‡è¯† | åç§° | ä½ç½® | çŠ¶æ€ |
|-----------|------|------|------|
| DINING_QR_MAIN_001 | é¤å…ä¸»å…¥å£äºŒç»´ç  | é¤å…ä¸»å…¥å£ | active |
| DINING_QR_MAIN_002 | é¤å…AåŒºäºŒç»´ç  | é¤å…AåŒº | active |
| DINING_QR_MAIN_003 | é¤å…BåŒºäºŒç»´ç  | é¤å…BåŒº | active |

### äºŒç»´ç ç”Ÿæˆè§„åˆ™

- **æ ¼å¼**: `DINING_QR_${æ—¶é—´æˆ³}_${éšæœºå­—ç¬¦ä¸²}`
- **ç¤ºä¾‹**: `DINING_QR_1705123456789_ABC123DEF`
- **å”¯ä¸€æ€§**: æ¯ä¸ªäºŒç»´ç éƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç 

## ğŸ”§ å‰ç«¯é›†æˆç¤ºä¾‹

### å®Œæ•´çš„æ‰«ç åŠŸèƒ½å®ç°

```javascript
class QRCodeManager {
  constructor(token) {
    this.token = token;
    this.baseURL = '/api/qr-scan';
  }
  
  // æ‰«ç å°±é¤ç™»è®°
  async scanQRCode(qrCode) {
    try {
      const response = await fetch(`${this.baseURL}/scan`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${this.token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          qrCode: qrCode,
          scanTime: new Date().toISOString()
        })
      });
      
      const result = await response.json();
      
      if (result.success) {
        return {
          success: true,
          data: result.data,
          message: result.message
        };
      } else {
        return {
          success: false,
          message: result.message
        };
      }
    } catch (error) {
      return {
        success: false,
        message: 'ç½‘ç»œè¯·æ±‚å¤±è´¥'
      };
    }
  }
  
  // è·å–ç”¨æˆ·å†å²è®°å½•
  async getUserHistory(date = null, limit = 20, offset = 0) {
    try {
      const params = new URLSearchParams();
      if (date) params.append('date', date);
      params.append('limit', limit);
      params.append('offset', offset);
      
      const response = await fetch(`${this.baseURL}/history?${params}`, {
        headers: {
          'Authorization': `Bearer ${this.token}`
        }
      });
      
      const result = await response.json();
      
      if (result.success) {
        return result.data;
      } else {
        throw new Error(result.message);
      }
    } catch (error) {
      console.error('è·å–å†å²è®°å½•å¤±è´¥:', error);
      throw error;
    }
  }
  
  // è·å–äºŒç»´ç åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰
  async getQRCodes(status = null, limit = 100, offset = 0) {
    try {
      const params = new URLSearchParams();
      if (status) params.append('status', status);
      params.append('limit', limit);
      params.append('offset', offset);
      
      const response = await fetch(`${this.baseURL}/qr-codes?${params}`, {
        headers: {
          'Authorization': `Bearer ${this.token}`
        }
      });
      
      const result = await response.json();
      
      if (result.success) {
        return result.data;
      } else {
        throw new Error(result.message);
      }
    } catch (error) {
      console.error('è·å–äºŒç»´ç åˆ—è¡¨å¤±è´¥:', error);
      throw error;
    }
  }
  
  // åˆ›å»ºäºŒç»´ç ï¼ˆç®¡ç†å‘˜ï¼‰
  async createQRCode(name, location, description = '') {
    try {
      const response = await fetch(`${this.baseURL}/qr-codes`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${this.token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name,
          location,
          description
        })
      });
      
      const result = await response.json();
      
      if (result.success) {
        return result.data;
      } else {
        throw new Error(result.message);
      }
    } catch (error) {
      console.error('åˆ›å»ºäºŒç»´ç å¤±è´¥:', error);
      throw error;
    }
  }
  
  // ç”ŸæˆäºŒç»´ç å›¾ç‰‡
  async generateQRCodeImage(qrCode, width = 200, margin = 2) {
    try {
      const response = await fetch(`${this.baseURL}/qr-codes/${qrCode}/image?width=${width}&margin=${margin}`, {
        headers: {
          'Authorization': `Bearer ${this.token}`
        }
      });
      
      const result = await response.json();
      
      if (result.success) {
        return result.data.imageDataURL;
      } else {
        throw new Error(result.message);
      }
    } catch (error) {
      console.error('ç”ŸæˆäºŒç»´ç å›¾ç‰‡å¤±è´¥:', error);
      throw error;
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const qrManager = new QRCodeManager(userToken);

// ç”Ÿæˆå¹¶æ˜¾ç¤ºäºŒç»´ç å›¾ç‰‡
async function displayQRCodes() {
  const qrCodes = [
    { code: 'DINING_QR_MAIN_001', name: 'é¤å…ä¸»å…¥å£äºŒç»´ç ', location: 'é¤å…ä¸»å…¥å£' },
    { code: 'DINING_QR_MAIN_002', name: 'é¤å…AåŒºäºŒç»´ç ', location: 'é¤å…AåŒº' },
    { code: 'DINING_QR_MAIN_003', name: 'é¤å…BåŒºäºŒç»´ç ', location: 'é¤å…BåŒº' }
  ];
  
  for (const qr of qrCodes) {
    try {
      const qrImageDataURL = await qrManager.generateQRCodeImage(qr.code, 200, 2);
      
      // åˆ›å»ºäºŒç»´ç æ˜¾ç¤ºå…ƒç´ 
      const qrContainer = document.createElement('div');
      qrContainer.className = 'qr-code-item';
      
      const qrImage = document.createElement('img');
      qrImage.src = qrImageDataURL;
      qrImage.alt = qr.name;
      
      const qrInfo = document.createElement('div');
      qrInfo.innerHTML = `
        <h3>${qr.name}</h3>
        <p>ä½ç½®: ${qr.location}</p>
        <p>æ ‡è¯†: ${qr.code}</p>
      `;
      
      qrContainer.appendChild(qrImage);
      qrContainer.appendChild(qrInfo);
      document.body.appendChild(qrContainer);
      
    } catch (error) {
      console.error(`ç”ŸæˆäºŒç»´ç  ${qr.code} å¤±è´¥:`, error);
    }
  }
}

// æ‰«ç å°±é¤
const scanResult = await qrManager.scanQRCode('DINING_QR_MAIN_001');
if (scanResult.success) {
  console.log('æ‰«ç æˆåŠŸ:', scanResult.message);
} else {
  console.error('æ‰«ç å¤±è´¥:', scanResult.message);
}
```

## ğŸ“Š æ€»ç»“

æœ¬æ–‡æ¡£æä¾›äº†äºŒç»´ç åŠŸèƒ½çš„å®Œæ•´APIæ¥å£è¯´æ˜ï¼ŒåŒ…æ‹¬ï¼š

- âœ… **ç”¨æˆ·ç«¯æ¥å£**: æ‰«ç ç™»è®°ã€å†å²æŸ¥è¯¢ã€ç»Ÿè®¡æŸ¥çœ‹
- âœ… **ç®¡ç†å‘˜æ¥å£**: äºŒç»´ç åˆ›å»ºã€åˆ—è¡¨æŸ¥è¯¢ã€è¯¦æƒ…æŸ¥çœ‹ã€çŠ¶æ€æ›´æ–°
- âœ… **å›ºå®šäºŒç»´ç **: ç³»ç»Ÿé»˜è®¤æä¾›çš„3ä¸ªå›ºå®šäºŒç»´ç 
- âœ… **å®Œæ•´ç¤ºä¾‹**: å‰ç«¯é›†æˆä»£ç å’Œä½¿ç”¨ç¤ºä¾‹
- âœ… **é”™è¯¯å¤„ç†**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³æ–¹æ¡ˆ

å‰ç«¯å¼€å‘è€…å¯ä»¥æ ¹æ®æœ¬æ–‡æ¡£å¿«é€Ÿé›†æˆäºŒç»´ç åŠŸèƒ½ã€‚
