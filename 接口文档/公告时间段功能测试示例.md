# 公告时间段功能测试示例

## 📋 测试说明

本文档提供公告时间段功能的测试示例，展示如何使用简化的日期字段创建时间段公告。

---

## 🧪 测试用例

### 测试用例1：创建临时公告（推荐用法）

**请求**:
```http
POST /api/admin/notices
Authorization: Bearer <your-jwt-token>
Content-Type: application/json

{
  "title": "春节放假通知",
  "content": "根据国家法定节假日安排，系统将于春节期间暂停服务，请提前做好相关准备。",
  "type": "info",
  "priority": 3,
  "status": "draft",
  "startDate": "2025-02-10",
  "endDate": "2025-02-17",
  "isSticky": true
}
```

**预期响应**:
```json
{
  "success": true,
  "message": "公告创建成功",
  "data": {
    "_id": "notice-002",
    "title": "春节放假通知",
    "content": "根据国家法定节假日安排，系统将于春节期间暂停服务，请提前做好相关准备。",
    "type": "info",
    "priority": 3,
    "status": "draft",
    "startTime": "2025-02-10T00:00:00.000Z",
    "endTime": "2025-02-17T23:59:59.999Z",
    "isSticky": true,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": null,
    "createTime": "2025-01-27T03:00:00.000Z",
    "updateTime": "2025-01-27T03:00:00.000Z"
  }
}
```

**验证要点**:
- ✅ `startTime` 自动设置为 `2025-02-10T00:00:00.000Z`
- ✅ `endTime` 自动设置为 `2025-02-17T23:59:59.999Z`
- ✅ 前端只需提供日期，无需关心具体时间

---

### 测试用例2：创建永久公告

**请求**:
```http
POST /api/admin/notices
Authorization: Bearer <your-jwt-token>
Content-Type: application/json

{
  "title": "系统使用说明",
  "content": "欢迎使用智慧物业管理系统，请仔细阅读以下使用说明...",
  "type": "info",
  "priority": 1,
  "status": "published",
  "isSticky": false
}
```

**预期响应**:
```json
{
  "success": true,
  "message": "公告创建成功",
  "data": {
    "_id": "notice-003",
    "title": "系统使用说明",
    "content": "欢迎使用智慧物业管理系统，请仔细阅读以下使用说明...",
    "type": "info",
    "priority": 1,
    "status": "published",
    "startTime": null,
    "endTime": null,
    "isSticky": false,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": "2025-01-27T03:00:00.000Z",
    "createTime": "2025-01-27T03:00:00.000Z",
    "updateTime": "2025-01-27T03:00:00.000Z"
  }
}
```

**验证要点**:
- ✅ `startTime` 和 `endTime` 都为 `null`（永久有效）
- ✅ 不填写日期字段创建永久公告

---

### 测试用例3：创建单日公告

**请求**:
```http
POST /api/admin/notices
Authorization: Bearer <your-jwt-token>
Content-Type: application/json

{
  "title": "系统升级通知",
  "content": "系统将于明天进行升级维护，预计维护时间2小时，请提前保存数据。",
  "type": "warning",
  "priority": 5,
  "status": "draft",
  "startDate": "2025-01-28",
  "endDate": "2025-01-28"
}
```

**预期响应**:
```json
{
  "success": true,
  "message": "公告创建成功",
  "data": {
    "_id": "notice-004",
    "title": "系统升级通知",
    "content": "系统将于明天进行升级维护，预计维护时间2小时，请提前保存数据。",
    "type": "warning",
    "priority": 5,
    "status": "draft",
    "startTime": "2025-01-28T00:00:00.000Z",
    "endTime": "2025-01-28T23:59:59.999Z",
    "isSticky": false,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": null,
    "createTime": "2025-01-27T03:00:00.000Z",
    "updateTime": "2025-01-27T03:00:00.000Z"
  }
}
```

**验证要点**:
- ✅ 同一天的开始和结束时间
- ✅ 开始时间：`00:00:00`，结束时间：`23:59:59`

---

### 测试用例4：更新公告时间段

**请求**:
```http
PUT /api/admin/notices/notice-002
Authorization: Bearer <your-jwt-token>
Content-Type: application/json

{
  "title": "春节放假通知（更新）",
  "startDate": "2025-02-11",
  "endDate": "2025-02-18",
  "priority": 5
}
```

**预期响应**:
```json
{
  "success": true,
  "message": "公告更新成功",
  "data": {
    "_id": "notice-002",
    "title": "春节放假通知（更新）",
    "content": "根据国家法定节假日安排，系统将于春节期间暂停服务，请提前做好相关准备。",
    "type": "info",
    "priority": 5,
    "status": "draft",
    "startTime": "2025-02-11T00:00:00.000Z",
    "endTime": "2025-02-18T23:59:59.999Z",
    "isSticky": true,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": null,
    "createTime": "2025-01-27T03:00:00.000Z",
    "updateTime": "2025-01-27T03:05:00.000Z"
  }
}
```

**验证要点**:
- ✅ 时间段已更新
- ✅ 优先级已更新
- ✅ 其他字段保持不变

---

## 🔍 错误测试用例

### 错误测试1：无效日期格式

**请求**:
```http
POST /api/admin/notices
Authorization: Bearer <your-jwt-token>
Content-Type: application/json

{
  "title": "测试公告",
  "content": "测试内容",
  "startDate": "2025/01/27",
  "endDate": "2025-01-31"
}
```

**预期响应**:
```json
{
  "success": false,
  "message": "开始日期格式无效，请使用YYYY-MM-DD格式",
  "data": null
}
```

### 错误测试2：开始日期晚于结束日期

**请求**:
```http
POST /api/admin/notices
Authorization: Bearer <your-jwt-token>
Content-Type: application/json

{
  "title": "测试公告",
  "content": "测试内容",
  "startDate": "2025-01-31",
  "endDate": "2025-01-27"
}
```

**预期响应**:
```json
{
  "success": false,
  "message": "开始日期不能晚于结束日期",
  "data": null
}
```

---

## 📊 时间转换对照表

| 前端输入 | 后端存储 | 说明 |
|----------|----------|------|
| `"2025-01-27"` | `"2025-01-27T00:00:00.000Z"` | 开始时间（当天00:00:00） |
| `"2025-01-27"` | `"2025-01-27T23:59:59.999Z"` | 结束时间（当天23:59:59） |
| 不填写 | `null` | 永久公告 |

---

## 🎯 前端实现建议

### 1. 表单验证
```javascript
function validateDateRange(startDate, endDate) {
  if (startDate && endDate) {
    if (new Date(startDate) > new Date(endDate)) {
      return '开始日期不能晚于结束日期';
    }
  }
  return null;
}
```

### 2. 数据提交
```javascript
function submitNotice() {
  const formData = {
    title: document.getElementById('title').value,
    content: document.getElementById('content').value,
    type: document.getElementById('type').value,
    priority: parseInt(document.getElementById('priority').value),
    isSticky: document.getElementById('isSticky').checked
  };
  
  // 添加日期字段（如果填写了）
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;
  
  if (startDate) formData.startDate = startDate;
  if (endDate) formData.endDate = endDate;
  
  // 发送请求...
}
```

### 3. 时间显示
```javascript
function formatNoticeTime(startTime, endTime) {
  if (!startTime && !endTime) {
    return '永久有效';
  }
  
  const start = new Date(startTime);
  const end = new Date(endTime);
  
  const startStr = start.toLocaleDateString('zh-CN');
  const endStr = end.toLocaleDateString('zh-CN');
  
  if (startStr === endStr) {
    return startStr; // 同一天
  } else {
    return `${startStr} 至 ${endStr}`;
  }
}
```

---

## ✅ 测试检查清单

- [ ] 创建临时公告（开始和结束日期）
- [ ] 创建永久公告（不填写日期）
- [ ] 创建单日公告（开始和结束日期相同）
- [ ] 更新公告时间段
- [ ] 验证日期格式错误处理
- [ ] 验证日期范围错误处理
- [ ] 验证时间自动转换正确性
- [ ] 验证前端表单提交
- [ ] 验证时间显示格式

---

**注意**: 这些测试用例展示了如何使用简化的日期字段创建时间段公告，前端只需要提供日期选择器，无需处理复杂的时间选择。

