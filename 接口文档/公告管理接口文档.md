# 公告管理接口文档

## 📋 概述

本文档详细说明公告管理系统的所有API接口，包括公告的增删改查、发布管理等功能。

**文档版本**: v1.0  
**最后更新**: 2025-01-27  
**适用范围**: 前端开发人员、后端开发人员

---

## 🔐 认证说明

所有公告管理接口都需要管理员权限，需要在请求头中携带有效的JWT Token：

```http
Authorization: Bearer <your-jwt-token>
```

---

## 📝 接口列表

### 1. 获取公告列表

**接口地址**: `GET /api/admin/notices`

**功能描述**: 获取公告列表，支持分页、筛选和搜索

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| page | number | 否 | 1 | 页码 |
| pageSize | number | 否 | 20 | 每页数量 |
| status | string | 否 | - | 状态筛选：draft(草稿)、published(已发布)、archived(已归档) |
| type | string | 否 | - | 类型筛选：info(信息)、warning(警告)、error(错误)、success(成功) |
| keyword | string | 否 | - | 关键词搜索（标题或内容） |

**请求示例**:
```http
GET /api/admin/notices?page=1&pageSize=10&status=published&type=info&keyword=系统
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取公告列表成功",
  "data": {
    "records": [
      {
        "_id": "notice-001",
        "title": "系统维护通知",
        "content": "系统将于今晚22:00-24:00进行维护...",
        "type": "warning",
        "priority": 5,
        "status": "published",
        "startTime": "2025-01-27T14:00:00.000Z",
        "endTime": "2025-01-28T02:00:00.000Z",
        "isSticky": true,
        "viewCount": 0,
        "publisherId": "admin-001",
        "publisherName": "系统管理员",
        "publishTime": "2025-01-27T02:51:39.000Z",
        "createTime": "2025-01-27T02:51:39.000Z",
        "updateTime": "2025-01-27T02:51:39.000Z"
      }
    ],
    "total": 15,
    "page": 1,
    "pageSize": 10,
    "hasMore": true,
    "totalPages": 2
  }
}
```

---

### 2. 获取公告详情

**接口地址**: `GET /api/admin/notices/:noticeId`

**功能描述**: 获取指定公告的详细信息

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| noticeId | string | 是 | 公告ID |

**请求示例**:
```http
GET /api/admin/notices/notice-001
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取公告详情成功",
  "data": {
    "_id": "notice-001",
    "title": "系统维护通知",
    "content": "系统将于今晚22:00-24:00进行维护，期间可能影响正常使用，请提前做好准备。",
    "type": "warning",
    "priority": 5,
    "status": "published",
    "startTime": "2025-01-27T14:00:00.000Z",
    "endTime": "2025-01-28T02:00:00.000Z",
    "targetUsers": ["user1", "user2"],
    "isSticky": true,
    "viewCount": 0,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": "2025-01-27T02:51:39.000Z",
    "createTime": "2025-01-27T02:51:39.000Z",
    "updateTime": "2025-01-27T02:51:39.000Z"
  }
}
```

---

### 3. 创建公告

**接口地址**: `POST /api/admin/notices`

**功能描述**: 创建新的公告

**请求体**:

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | string | 是 | 公告标题（最大200字符） |
| content | string | 是 | 公告内容 |
| type | string | 否 | 公告类型：info(信息)、warning(警告)、error(错误)、success(成功)，默认info |
| priority | number | 否 | 优先级（0-10），默认0 |
| status | string | 否 | 状态：draft(草稿)、published(已发布)、archived(已归档)，默认draft |
| startTime | string | 否 | 开始时间（ISO8601格式） |
| endTime | string | 否 | 结束时间（ISO8601格式） |
| isSticky | boolean | 否 | 是否置顶，默认false |
| targetUsers | array | 否 | 目标用户ID数组 |

**请求示例**:
```http
POST /api/admin/notices
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "title": "新功能上线通知",
  "content": "菜品管理功能已全新上线，支持菜品分类、图片上传、批量操作等新特性。",
  "type": "info",
  "priority": 3,
  "status": "draft",
  "startTime": "2025-01-27T00:00:00.000Z",
  "endTime": "2025-12-31T23:59:59.000Z",
  "isSticky": false,
  "targetUsers": ["user1", "user2"]
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "公告创建成功",
  "data": {
    "_id": "notice-002",
    "title": "新功能上线通知",
    "content": "菜品管理功能已全新上线，支持菜品分类、图片上传、批量操作等新特性。",
    "type": "info",
    "priority": 3,
    "status": "draft",
    "startTime": "2025-01-27T00:00:00.000Z",
    "endTime": "2025-12-31T23:59:59.000Z",
    "isSticky": false,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": null,
    "createTime": "2025-01-27T03:00:00.000Z",
    "updateTime": "2025-01-27T03:00:00.000Z"
  }
}
```

---

### 4. 更新公告

**接口地址**: `PUT /api/admin/notices/:noticeId`

**功能描述**: 更新指定公告的信息

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| noticeId | string | 是 | 公告ID |

**请求体**: 与创建公告相同，所有字段都是可选的

**请求示例**:
```http
PUT /api/admin/notices/notice-002
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "title": "新功能上线通知（更新）",
  "priority": 5,
  "isSticky": true
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "公告更新成功",
  "data": {
    "_id": "notice-002",
    "title": "新功能上线通知（更新）",
    "content": "菜品管理功能已全新上线，支持菜品分类、图片上传、批量操作等新特性。",
    "type": "info",
    "priority": 5,
    "status": "draft",
    "startTime": "2025-01-27T00:00:00.000Z",
    "endTime": "2025-12-31T23:59:59.000Z",
    "isSticky": true,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": null,
    "createTime": "2025-01-27T03:00:00.000Z",
    "updateTime": "2025-01-27T03:05:00.000Z"
  }
}
```

---

### 5. 删除公告

**接口地址**: `DELETE /api/admin/notices/:noticeId`

**功能描述**: 删除指定公告

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| noticeId | string | 是 | 公告ID |

**请求示例**:
```http
DELETE /api/admin/notices/notice-002
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**响应示例**:
```json
{
  "success": true,
  "message": "公告删除成功",
  "data": null
}
```

---

### 6. 发布公告

**接口地址**: `POST /api/admin/notices/:noticeId/publish`

**功能描述**: 发布指定公告

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| noticeId | string | 是 | 公告ID |

**请求示例**:
```http
POST /api/admin/notices/notice-002/publish
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**响应示例**:
```json
{
  "success": true,
  "message": "公告发布成功",
  "data": {
    "_id": "notice-002",
    "title": "新功能上线通知（更新）",
    "content": "菜品管理功能已全新上线，支持菜品分类、图片上传、批量操作等新特性。",
    "type": "info",
    "priority": 5,
    "status": "published",
    "startTime": "2025-01-27T00:00:00.000Z",
    "endTime": "2025-12-31T23:59:59.000Z",
    "isSticky": true,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": "2025-01-27T03:10:00.000Z",
    "createTime": "2025-01-27T03:00:00.000Z",
    "updateTime": "2025-01-27T03:10:00.000Z"
  }
}
```

---

### 7. 取消发布公告

**接口地址**: `POST /api/admin/notices/:noticeId/unpublish`

**功能描述**: 取消发布指定公告

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| noticeId | string | 是 | 公告ID |

**请求示例**:
```http
POST /api/admin/notices/notice-002/unpublish
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**响应示例**:
```json
{
  "success": true,
  "message": "公告取消发布成功",
  "data": {
    "_id": "notice-002",
    "title": "新功能上线通知（更新）",
    "content": "菜品管理功能已全新上线，支持菜品分类、图片上传、批量操作等新特性。",
    "type": "info",
    "priority": 5,
    "status": "draft",
    "startTime": "2025-01-27T00:00:00.000Z",
    "endTime": "2025-12-31T23:59:59.000Z",
    "isSticky": true,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": null,
    "createTime": "2025-01-27T03:00:00.000Z",
    "updateTime": "2025-01-27T03:15:00.000Z"
  }
}
```

---

### 8. 批量删除公告

**接口地址**: `DELETE /api/admin/notices/batch`

**功能描述**: 批量删除多个公告

**请求体**:

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| noticeIds | array | 是 | 公告ID数组 |

**请求示例**:
```http
DELETE /api/admin/notices/batch
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "noticeIds": ["notice-001", "notice-002", "notice-003"]
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "批量删除公告成功",
  "data": {
    "successCount": 2,
    "totalCount": 3,
    "errors": [
      {
        "noticeId": "notice-003",
        "error": "公告不存在"
      }
    ]
  }
}
```

---

## 📊 数据字段说明

### 公告对象字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| _id | string | 公告唯一标识符 |
| title | string | 公告标题 |
| content | string | 公告内容 |
| type | string | 公告类型：info、warning、error、success |
| priority | number | 优先级（0-10，数字越大优先级越高） |
| status | string | 状态：draft、published、archived |
| startTime | string | 开始时间（ISO8601格式） |
| endTime | string | 结束时间（ISO8601格式） |
| targetUsers | array | 目标用户ID数组 |
| isSticky | boolean | 是否置顶 |
| viewCount | number | 查看次数 |
| publisherId | string | 发布者ID |
| publisherName | string | 发布者姓名 |
| publishTime | string | 发布时间（ISO8601格式） |
| createTime | string | 创建时间（ISO8601格式） |
| updateTime | string | 更新时间（ISO8601格式） |

---

## ⚠️ 错误码说明

| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 400 | 请求参数错误 | 检查请求参数格式和必填字段 |
| 401 | 未授权 | 检查JWT Token是否有效 |
| 403 | 权限不足 | 确认用户具有管理员权限 |
| 404 | 公告不存在 | 检查公告ID是否正确 |
| 500 | 服务器内部错误 | 联系技术支持 |

---

## 🔍 常见问题

### Q1: 如何获取有效的JWT Token？
A: 使用管理员账号登录认证接口获取Token，然后在请求头中携带。

### Q2: 公告的优先级如何排序？
A: 优先级数字越大优先级越高，同时置顶公告会优先显示。

### Q3: 如何实现公告的定时发布？
A: 可以设置startTime和endTime字段，系统会根据时间自动控制公告的显示状态。

### Q4: 批量删除时部分失败如何处理？
A: 响应中会返回详细的成功和失败信息，可以根据errors数组处理失败的项目。

---

## 📞 技术支持

如有问题请联系开发团队或查看系统日志获取详细错误信息。

---

**注意**: 本文档基于当前系统实现情况编写，随着功能开发进度会持续更新。
