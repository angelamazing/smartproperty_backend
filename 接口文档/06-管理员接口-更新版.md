# 管理员接口文档

## 📋 接口概述

管理员接口提供系统管理、菜单管理、用户管理、角色管理、公告管理、数据统计等管理员功能。

**基础路径**: `/api/admin`

**认证要求**: 所有接口都需要有效的JWT Token和管理员权限

## 🔐 接口列表

### 1. 系统统计模块

#### 1.1 获取系统统计数据

**接口地址**: `GET /api/admin/system-stats`

**接口描述**: 获取系统整体统计数据

**请求头**:
```http
Authorization: Bearer {token}
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取系统统计成功",
  "data": {
    "userStats": {
      "totalUsers": 156,
      "activeUsers": 142,
      "newUsersThisMonth": 12,
      "userGrowthRate": "8.3%"
    },
    "diningStats": {
      "totalOrders": 2340,
      "ordersThisMonth": 456,
      "averageOrderAmount": 28.5,
      "popularMealType": "lunch"
    },
    "reservationStats": {
      "totalReservations": 890,
      "reservationsThisMonth": 67,
      "averageUtilization": "65.2%",
      "popularVenue": "会议室A"
    },
    "systemStats": {
      "uptime": "99.8%",
      "lastBackup": "2024-01-15T02:00:00.000Z",
      "databaseSize": "2.3GB",
      "activeConnections": 45
    }
  },
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

#### 1.2 获取系统状态

**接口地址**: `GET /api/admin/system/status`

**接口描述**: 获取系统运行状态信息

**请求头**:
```http
Authorization: Bearer {token}
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取系统状态成功",
  "data": {
    "status": "running",
    "version": "1.0.0",
    "uptime": "15天 8小时 32分钟",
    "memoryUsage": "65.2%",
    "cpuUsage": "23.1%",
    "diskUsage": "45.8%",
    "databaseStatus": "connected",
    "lastRestart": "2024-01-01T00:00:00.000Z"
  },
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

### 2. 用户管理模块

#### 2.1 获取用户列表

**接口地址**: `GET /api/admin/users`

**接口描述**: 获取用户列表，支持分页和筛选

**请求头**:
```http
Authorization: Bearer {token}
```

**查询参数**:
```
page: number          // 页码，默认1
pageSize: number      // 每页数量，默认20，最大100
status: string        // 状态筛选：active/inactive/deleted（可选）
keyword: string       // 关键词搜索（姓名/手机号）
departmentId: string  // 部门ID筛选（可选）
role: string          // 角色筛选（可选）
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取用户列表成功",
  "data": {
    "records": [
      {
        "_id": "user_001",
        "nickName": "张三",
        "realName": "张三",
        "phoneNumber": "13800138000",
        "role": "user",
        "departmentId": "dept_001",
        "departmentName": "技术部",
        "status": "active",
        "createTime": "2024-01-01T00:00:00.000Z",
        "lastLoginTime": "2024-01-15T09:30:00.000Z"
      }
    ],
    "total": 156,
    "page": 1,
    "pageSize": 20
  },
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

#### 2.2 获取用户详情

**接口地址**: `GET /api/admin/users/{userId}`

**接口描述**: 获取指定用户的详细信息

**路径参数**:
```
userId: string  // 用户ID
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取用户详情成功",
  "data": {
    "_id": "user_001",
    "nickName": "张三",
    "realName": "张三",
    "phoneNumber": "13800138000",
    "role": "user",
    "departmentId": "dept_001",
    "departmentName": "技术部",
    "status": "active",
    "createTime": "2024-01-01T00:00:00.000Z",
    "lastLoginTime": "2024-01-15T09:30:00.000Z",
    "profile": {
      "avatar": "https://example.com/avatar.jpg",
      "email": "zhangsan@example.com",
      "address": "北京市朝阳区"
    }
  },
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

#### 2.3 创建用户

**接口地址**: `POST /api/admin/users`

**接口描述**: 创建新用户

**请求体参数**:
```json
{
  "nickName": "李四",
  "realName": "李四",
  "phoneNumber": "13800138001",
  "role": "user",
  "departmentId": "dept_001",
  "status": "active"
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "创建用户成功",
  "data": {
    "_id": "user_002",
    "nickName": "李四",
    "realName": "李四",
    "phoneNumber": "13800138001",
    "role": "user",
    "departmentId": "dept_001",
    "status": "active",
    "createTime": "2024-01-15T10:30:00.000Z"
  },
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

#### 2.4 更新用户

**接口地址**: `PUT /api/admin/users/{userId}`

**接口描述**: 更新用户信息

**路径参数**:
```
userId: string  // 用户ID
```

**请求体参数**: 与创建用户相同，所有字段都是可选的

#### 2.5 更新用户状态

**接口地址**: `PUT /api/admin/users/{userId}/status`

**接口描述**: 更新用户状态

**请求体参数**:
```json
{
  "status": "inactive"
}
```

#### 2.6 删除用户

**接口地址**: `DELETE /api/admin/users/{userId}`

**接口描述**: 删除用户（软删除）

#### 2.7 批量删除用户

**接口地址**: `POST /api/admin/users/batch-delete`

**接口描述**: 批量删除用户

**请求体参数**:
```json
{
  "userIds": ["user_001", "user_002", "user_003"]
}
```

#### 2.8 获取用户活动记录

**接口地址**: `GET /api/admin/users/{userId}/activities`

**接口描述**: 获取用户活动记录

**查询参数**:
```
page: number      // 页码，默认1
pageSize: number  // 每页数量，默认20
```

### 3. 角色管理模块

#### 3.1 获取角色列表

**接口地址**: `GET /api/admin/roles`

**接口描述**: 获取所有活跃角色的列表，包含权限信息和用户数量

**响应示例**:
```json
{
  "success": true,
  "message": "获取角色列表成功",
  "data": [
    {
      "id": "role_001",
      "name": "user",
      "description": "普通用户",
      "status": "active",
      "create_time": "2025-01-01T00:00:00.000Z",
      "update_time": "2025-01-01T00:00:00.000Z",
      "create_by": null,
      "user_count": 56,
      "permissions": [],
      "permissionCount": 0
    },
    {
      "id": "role_002",
      "name": "admin",
      "description": "普通管理员",
      "status": "active",
      "create_time": "2025-01-01T00:00:00.000Z",
      "update_time": "2025-01-01T00:00:00.000Z",
      "create_by": null,
      "user_count": 0,
      "permissions": [],
      "permissionCount": 0
    },
    {
      "id": "role_003",
      "name": "sys_admin",
      "description": "系统管理员",
      "status": "active",
      "create_time": "2025-01-01T00:00:00.000Z",
      "update_time": "2025-01-01T00:00:00.000Z",
      "create_by": null,
      "user_count": 1,
      "permissions": [],
      "permissionCount": 0
    }
  ],
  "timestamp": "2025-01-01T12:00:00.000Z"
}
```

#### 3.2 获取角色详情

**接口地址**: `GET /api/admin/roles/{roleId}`

**接口描述**: 根据角色ID获取角色详细信息，包含权限列表和分配的用户

**路径参数**:
```
roleId: string  // 角色ID
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取角色详情成功",
  "data": {
    "id": "role_001",
    "name": "user",
    "description": "普通用户",
    "status": "active",
    "create_time": "2025-01-01T00:00:00.000Z",
    "update_time": "2025-01-01T00:00:00.000Z",
    "create_by": null,
    "permissions": [],
    "permissionCount": 0,
    "assignedUsers": [],
    "userCount": 0
  },
  "timestamp": "2025-01-01T12:00:00.000Z"
}
```

#### 3.3 创建角色

**接口地址**: `POST /api/admin/roles`

**接口描述**: 创建新的角色

**请求体参数**:
```json
{
  "name": "内容编辑员",
  "description": "负责内容编辑和审核",
  "permissions": [],
  "status": "active"
}
```

#### 3.4 更新角色

**接口地址**: `PUT /api/admin/roles/{roleId}`

**接口描述**: 更新角色信息

#### 3.5 删除角色

**接口地址**: `DELETE /api/admin/roles/{roleId}`

**接口描述**: 删除角色（软删除）

#### 3.6 获取权限列表

**接口地址**: `GET /api/admin/permissions`

**接口描述**: 获取所有可用权限列表，按模块分组

**响应示例**:
```json
{
  "success": true,
  "message": "获取权限列表成功",
  "data": {
    "permissions": [],
    "groupedPermissions": {}
  },
  "timestamp": "2025-01-01T12:00:00.000Z"
}
```

#### 3.7 更新角色权限

**接口地址**: `PUT /api/admin/roles/{roleId}/permissions`

**接口描述**: 更新角色的权限分配

**请求体参数**:
```json
{
  "permissionIds": ["perm_001", "perm_002", "perm_003"]
}
```

#### 3.8 分配角色

**接口地址**: `POST /api/admin/roles/assign`

**接口描述**: 将角色分配给指定用户

**请求体参数**:
```json
{
  "userId": "user_001",
  "roleId": "role_004"
}
```

#### 3.9 批量分配角色

**接口地址**: `POST /api/admin/roles/batch-assign`

**接口描述**: 批量分配角色给多个用户

**请求体参数**:
```json
{
  "assignments": [
    {
      "userId": "user_001",
      "roleId": "role_004"
    },
    {
      "userId": "user_002",
      "roleId": "role_004"
    }
  ]
}
```

### 4. 公告管理模块

#### 4.1 获取公告列表

**接口地址**: `GET /api/admin/notices`

**接口描述**: 分页获取公告列表，支持多种筛选条件

**查询参数**:
```
page: number      // 页码，默认1
pageSize: number  // 每页数量，默认20
status: string    // 公告状态：draft/published/archived（可选）
type: string      // 公告类型：info/warning/error/success（可选）
keyword: string   // 搜索关键词（标题或内容）
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取公告列表成功",
  "data": {
    "records": [
      {
        "_id": "notice-001",
        "title": "系统维护通知",
        "content": "系统将于今晚进行维护...",
        "type": "info",
        "priority": 1,
        "status": "published",
        "startTime": "2025-01-01T00:00:00.000Z",
        "endTime": "2025-01-31T23:59:59.000Z",
        "targetUsers": ["user-001", "user-002"],
        "isSticky": true,
        "viewCount": 150,
        "publisherId": "admin-001",
        "publisherName": "系统管理员",
        "publishTime": "2025-01-01T10:00:00.000Z",
        "createTime": "2025-01-01T09:00:00.000Z",
        "updateTime": "2025-01-01T10:00:00.000Z"
      }
    ],
    "total": 25,
    "page": 1,
    "pageSize": 10
  },
  "timestamp": "2025-01-01T12:00:00.000Z"
}
```

#### 4.2 获取公告详情

**接口地址**: `GET /api/admin/notices/{noticeId}`

**接口描述**: 根据公告ID获取公告详细信息

#### 4.3 创建公告

**接口地址**: `POST /api/admin/notices`

**接口描述**: 创建新的公告

**请求体参数**:
```json
{
  "title": "重要系统更新通知",
  "content": "系统将于本周六进行重要更新，请提前保存数据。",
  "type": "warning",
  "priority": 3,
  "status": "draft",
  "startTime": "2025-01-01T00:00:00.000Z",
  "endTime": "2025-01-31T23:59:59.000Z",
  "targetUsers": ["user-001", "user-002"],
  "isSticky": true,
  "publisherId": "admin-001",
  "publisherName": "系统管理员"
}
```

#### 4.4 更新公告

**接口地址**: `PUT /api/admin/notices/{noticeId}`

**接口描述**: 更新指定公告的信息

#### 4.5 删除公告

**接口地址**: `DELETE /api/admin/notices/{noticeId}`

**接口描述**: 删除指定的公告

#### 4.6 发布公告

**接口地址**: `POST /api/admin/notices/{noticeId}/publish`

**接口描述**: 将草稿状态的公告发布

#### 4.7 取消发布公告

**接口地址**: `POST /api/admin/notices/{noticeId}/unpublish`

**接口描述**: 将已发布的公告取消发布，转为草稿状态

#### 4.8 批量删除公告

**接口地址**: `POST /api/admin/notices/batch-delete`

**接口描述**: 批量删除多个公告

**请求体参数**:
```json
{
  "noticeIds": ["notice-001", "notice-002", "notice-003"]
}
```

### 5. 菜单管理模块

#### 5.1 保存菜单草稿

**接口地址**: `POST /api/admin/menu/draft`

**接口描述**: 保存菜单草稿

#### 5.2 发布菜单

**接口地址**: `POST /api/admin/menu/publish`

**接口描述**: 发布菜单

#### 5.3 获取菜单历史

**接口地址**: `GET /api/admin/menu/history`

**接口描述**: 获取菜单发布历史

#### 5.4 获取菜单模板

**接口地址**: `GET /api/admin/menu/templates`

**接口描述**: 获取菜单模板列表

#### 5.5 撤销菜单

**接口地址**: `POST /api/admin/menu/revoke`

**接口描述**: 撤销已发布的菜单

#### 5.6 删除菜单模板

**接口地址**: `DELETE /api/admin/menu/templates/{templateId}`

**接口描述**: 删除菜单模板

#### 5.7 获取菜单菜品

**接口地址**: `GET /api/admin/menu/dishes`

**接口描述**: 获取菜单菜品列表

#### 5.8 设置菜单菜品

**接口地址**: `POST /api/admin/menu/dishes`

**接口描述**: 设置菜单菜品

#### 5.9 按日期获取菜单

**接口地址**: `GET /api/admin/menu/by-date`

**接口描述**: 按日期获取菜单信息

### 6. 菜品管理模块

#### 6.1 获取菜品列表

**接口地址**: `GET /api/admin/dishes`

**接口描述**: 获取菜品列表，支持分页和筛选

#### 6.2 创建菜品

**接口地址**: `POST /api/admin/dishes`

**接口描述**: 创建新菜品

#### 6.3 更新菜品

**接口地址**: `PUT /api/admin/dishes/{dishId}`

**接口描述**: 更新菜品信息

#### 6.4 更新菜品状态

**接口地址**: `PUT /api/admin/dishes/{dishId}/status`

**接口描述**: 更新菜品状态

#### 6.5 删除菜品

**接口地址**: `DELETE /api/admin/dishes/{dishId}`

**接口描述**: 删除菜品

#### 6.6 批量删除菜品

**接口地址**: `POST /api/admin/dishes/batch-delete`

**接口描述**: 批量删除菜品

#### 6.7 获取菜品分类

**接口地址**: `GET /api/admin/dishes/categories`

**接口描述**: 获取菜品分类列表

#### 6.8 创建菜品分类

**接口地址**: `POST /api/admin/dishes/categories`

**接口描述**: 创建菜品分类

#### 6.9 获取营养模板

**接口地址**: `GET /api/admin/nutrition/templates`

**接口描述**: 获取营养模板列表

### 7. 场地管理模块

#### 7.1 获取场地列表

**接口地址**: `GET /api/admin/venues`

**接口描述**: 获取场地列表，支持分页和筛选

#### 7.2 创建场地

**接口地址**: `POST /api/admin/venues`

**接口描述**: 创建新场地

#### 7.3 更新场地

**接口地址**: `PUT /api/admin/venues/{venueId}`

**接口描述**: 更新场地信息

#### 7.4 获取场地时间段

**接口地址**: `GET /api/admin/venues/{venueId}/time-slots`

**接口描述**: 获取场地时间段信息

#### 7.5 创建时间段

**接口地址**: `POST /api/admin/venues/{venueId}/time-slots`

**接口描述**: 为场地创建时间段

### 8. 预约管理模块

#### 8.1 获取预约列表

**接口地址**: `GET /api/admin/reservations`

**接口描述**: 获取预约列表，支持分页和筛选

#### 8.2 确认预约

**接口地址**: `PUT /api/admin/reservations/{reservationId}/confirm`

**接口描述**: 确认预约

#### 8.3 拒绝预约

**接口地址**: `PUT /api/admin/reservations/{reservationId}/reject`

**接口描述**: 拒绝预约

### 9. 系统配置模块

#### 9.1 获取系统配置

**接口地址**: `GET /api/admin/system/configs`

**接口描述**: 获取系统配置信息

#### 9.2 更新系统配置

**接口地址**: `PUT /api/admin/system/configs`

**接口描述**: 更新系统配置

#### 9.3 获取验证方案

**接口地址**: `GET /api/admin/system/verification-schemes`

**接口描述**: 获取验证方案列表

## 📊 数据字典

### 用户状态 (status)

| 值 | 说明 |
|----|------|
| active | 活跃 |
| inactive | 非活跃 |
| deleted | 已删除 |

### 角色类型

| 角色名称 | 角色代码 | 说明 |
|----------|----------|------|
| 普通用户 | user | 系统普通用户，基础权限 |
| 普通管理员 | admin | 部门管理员，管理权限 |
| 系统管理员 | sys_admin | 系统管理员，最高权限 |

### 公告状态 (status)

| 值 | 说明 |
|----|------|
| draft | 草稿 |
| published | 已发布 |
| archived | 已归档 |

### 公告类型 (type)

| 值 | 说明 |
|----|------|
| info | 信息 |
| warning | 警告 |
| error | 错误 |
| success | 成功 |

### 公告优先级 (priority)

| 值 | 说明 |
|----|------|
| 0 | 最低优先级 |
| 1 | 低优先级 |
| 2 | 普通优先级 |
| 3 | 高优先级 |
| 4 | 较高优先级 |
| 5 | 最高优先级 |

## 🔧 错误码说明

| 错误码 | 说明 |
|--------|------|
| 400 | 请求参数错误 |
| 401 | 未授权，Token无效或过期 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 409 | 资源冲突（如角色名称重复） |
| 500 | 服务器内部错误 |

## 📝 注意事项

1. **认证要求**: 所有接口都需要有效的JWT Token
2. **权限控制**: 需要管理员权限才能访问这些接口
3. **数据验证**: 所有输入数据都会进行严格验证
4. **分页限制**: 单次查询最多返回100条记录
5. **软删除**: 删除操作采用软删除方式，保护数据完整性
6. **权限表**: 权限管理功能需要`permissions`和`role_permissions`表支持

## 🚀 快速开始

### 1. 获取认证Token

```bash
curl -X POST http://localhost:3000/api/auth/test-login-admin \
  -H "Content-Type: application/json" \
  -d '{"phoneNumber": "13800000001", "password": "admin123"}'
```

### 2. 使用Token访问接口

```bash
# 获取系统统计
curl -X GET http://localhost:3000/api/admin/system-stats \
  -H "Authorization: Bearer {your-token}"

# 获取用户列表
curl -X GET http://localhost:3000/api/admin/users \
  -H "Authorization: Bearer {your-token}"

# 获取角色列表
curl -X GET http://localhost:3000/api/admin/roles \
  -H "Authorization: Bearer {your-token}"

# 获取公告列表
curl -X GET http://localhost:3000/api/admin/notices \
  -H "Authorization: Bearer {your-token}"
```

## 📖 更新日志

- **v1.0.0** (2025-01-01): 初始版本，包含基础管理员功能
- **v1.1.0** (2025-01-01): 添加角色管理功能
- **v1.2.0** (2025-01-01): 添加公告管理功能
- **v1.3.0** (2025-01-01): 优化用户管理功能
- **v1.4.0** (2025-01-01): 完善权限管理功能

---

**相关文档**: [角色管理接口文档](./角色管理接口文档.md) | [公告管理接口文档](./公告管理接口文档.md) | [用户接口文档](./02-用户接口.md)
